
                                  ┏━━━━━━━━━━━━━┓
                                  ┃   SAM CLI   ┃
                                  ┗━━━━━━━━━━━━━┛

VERSION ==>                       #1.127.0

SAR ==>                           #See its doc
TRANSFORM ==>                     #See its doc

                                  ┌─────────────┐
                                  │   INSTALL   │
                                  └─────────────┘

INSTALL ==>                       #Download|extract zip from GitHub releases

./install                         #Install script
                                  #Just copies files and create symlinks
                                  #Can delete zip extracted contents afterwards

--update|-u                       #Update instead of new install
                                  #Previous versions kept at INSTALL_DIR/X.Y.Z
                                  #Current version is symlink from INSTALL_DIR/current to INSTALL_DIR/X.Y.Z
GLOBAL_CONFIG.lastVersionCheck    #DATE_NUM of last version check
                                  #Once per week, check for new version and print if exists

--install-dir|-i                  #'INSTALL_DIR' (def: /usr/local/aws-sam-cli) containing binary + source code
--bin-dir|-b                      #'DIR' (def: /usr/local/bin) with symlink to `sam` executable

                                  ┌────────────┐
                                  │   CONFIG   │
                                  └────────────┘

~/.aws-sam/metadata.json          #GLOBAL_CONFIG. Undocumented by SAM, but we document some of it here
                                  #As opposed to CONFIG (per-project)

sam ...
--config-file                     #'PATH' to CONFIG (def: './samconfig.y[a]ml|toml')
                                  #Relative paths use TEMPLATE's DIR
--config-env                      #'SAM_PROFILE' (def: 'default')
--save-params                     #Save CLI FLAGs to CONFIG file

CONFIG.version                    #Must be 0.1
CONFIG.SAM_PROFILE.COMMAND|global #Default VAL for CLI flags
 .parameters.FLAG                 #snake_case for COMMAND + FLAG, e.g. local start-api -> local_start_api
                                  #BOOL FLAGs with default true must be named no_*
                                  #  - e.g. no_interactive BOOL

YAML SYNTAX ==>                   #Multiple VALs: ARR

TOML SYNTAX ==>                   #Multiple VALs: "VAL ..."
                                  #OBJ: "VAR=VAL ..."
                                  #OBJ_ARR: ["VAR=VAL ...", ...]
[SAM_PROFILE]
[SAM_PROFILE.COMMAND|global]
[SAM_PROFILE.COMMAND|global
 .parameters]                     #When using TOML, each depth level must be defined

                                  ┌─────────────┐
                                  │   GENERAL   │
                                  └─────────────┘

GLOBAL_CONFIG.experimentalAll
ENVVAR SAM_CLI_BETA_FEATURES
sam ... --[no-]beta-features      #BOOL (def: false). Enable all SAM_CLI_BETA_* features

GLOBAL_CONFIG.telemetryEnabled
ENVVAR SAM_CLI_TELEMETRY=0        #Disable telemetry

GLOBAL_CONFIG.installationId      #'UUID' created at install time, used for telemetry
TEMPLATE.Metadata.SamCliInfo
 .installationId                  #Set for the bootstrap STACK created by --resolve-s3

sam ...
--debug                           #Debug logs

sam docs CLI_COMMAND              #Open docs in browser

                                  ┌─────────────────┐
                                  │   ENVIRONMENT   │
                                  └─────────────────┘

sam ...
--profile                         #AWS CONFIG 'PROFILE' (def: guessed)
--region                          #'REGION' (def: guessed)

sam local generate-event
--partition                       #'PARTITION' (def: 'aws')

                                  ┌──────────────────┐
                                  │   STACK CONFIG   │
                                  └──────────────────┘

sam validate|build|sync|package   #'PATH' to TEMPLATE
 |deploy|publish|local|list       #Def:
ENVVAR SAM_TEMPLATE_FILE          #  - './.aws-sam/build/template.yaml': with sam package|deploy|publish|local
--template[-file]|-t              #  - 'template.y[a]ml|json'

sam remote|sync|deploy|delete
--stack-name                      #CloudFormation 'STACK'. Required
sam list
--stack-name                      #CloudFormation 'STACK'
                                  #If not provided, only provide local information, i.e. does not fetch CloudFormation API

sam build|local|sync|remote|list
--parameter-overrides             #'PARAM=VAL,...'. STACK.Parameters

                                  ┌──────────┐
                                  │   LINT   │
                                  └──────────┘

sam validate                      #Validate TEMPLATE syntax
--lint                            #BOOL (def: false, recommended: true). Run cfn-lint

                                  ┌──────────┐
                                  │   INIT   │
                                  └──────────┘

sam init                          #Scaffolds:
                                  #  - samconfig.toml:
                                  #     - for SAM_PROFILE 'default'
                                  #     - with flags documented here as "recommended"
                                  #  - TEMPLATE
                                  #  - code|tests for FUNCTIONs
                                  #  - package.json and dev tasks
                                  #  - Dockerfile (if PackageType 'Image')
                                  #  - CodeBuild buildspec.yml
                                  #  - TEST_EVENT
                                  #Based on a repository called aws-sam-cli-app-templates

--output-dir|-o                   #'DIR' (def: '.'). Outputs at DIR/PROJECT_NAME/
--name|-n                         #'PROJECT_NAME', used in:
                                  #  - default 'STACK' (in CONFIG file)
                                  #  - TEMPLATE.Description
                                  #  - README

--no-interactive                  #BOOL. If false (def), Interactive input for required flags
--no-input                        #BOOL. If false (def), same for optional flags

--package-type                    #FUNC_VERSION.PackageType (def: 'Zip')
--architecture                    #FUNC_VERSION.Architectures
--runtime                         #FUNC_VERSION.Runtime
--base-image                      #'amazon/RUNTIME-base'. Like --runtime but when PackageType 'Image'
                                  #Use Docker image 'public.ecr.aws/lambda/RUNTIME'
--dependency-manager              #Package manager used in FUNCTION
                                  #Depends on RUNTIME:
                                  #  - JavaScript: 'npm'
                                  #  - Python: 'pip'
                                  #  - Ruby: 'bundler'
                                  #  - DotNet: 'cli-package'
                                  #  - Java: 'gradle' or 'maven'
                                  #Def: guessed from --runtime or --base-image, unless Java
--extra-context                   #'{"SCAFFOLDING_VAR": "VAL",...}_JSON'
                                  #Additional options. Only for specific scaffolders

--app-template                    #Builtin cookiecutter scaffolder
                                  #Many of them are available only on specific RUNTIMEs
                                  #The scaffolded contents depends on --runtime, --package-type, --base-image, --dependency-manager
                                  #Can be any of the following:
quick-start-from-scratch          #FUNCTION
response-streaming                #FUNCTION with InvokeMode RESPONSE_STREAM
hello-world-lambda-image          #FUNCTION + API Gateway ROUTE, with PackageType 'Image'
                                  #Def when using PackageType 'Image'
hello-world                       #FUNCTION + API Gateway ROUTE, with PackageType 'Zip'
hello-world-typescript            #Same but in TypeScript, with esbuild
hello-world-powertools-           #Same but uses @aws-lambda-powertools/tracing|metrics|logger in FUNCTION
 typescript|dotnet|java|python    #Has SCAFFOLDING_VAR 'Powertools for AWS Lambda (TypeScript) Tracing|Metrics|Logging' 'enabled' or 'disabled' (def)
hello-world-native-aot            #FUNCTION using specific bundler for DotNet
quick-start-s3                    #FUNCTION handling BUCKET events
quick-start-
 sns|sqs|cloudwatch-events|dbd    #Similar for other SERVICEs
eventBridge-hello-world           #Similar for Event Bridge
eventBridge-schema-app            #Same but can customize using multiple SCAFFOLDING_VARs 'AWS_Schema_*' (not documented yet)
efs-sample-app                    #FUNCTION using EFS + API Gateway ROUTE
quick-start-web                   #CRUD FUNCTIONs + API Gateway ROUTEs + DynamoDB TABLE
quick-start-full-stack            #Same but also BUCKET + CloudFront DISTRIBUTION
graphql-api-sample-app            #AWS::Serverless::GraphQLApi + FUNCTIONs + DynamoDB TABLE
step-functions-sample-app         #AWS::Serverless::StateMachine + FUNCTIONs + DynamoDB TABLE
ml-apigw-pytorch|tensorflow       #Machine learning FUNCTION
 |xgboost|scikit-learn            #Uses specific SCAFFOLDING_VARs to set paths and dependencies version (not documented yet)
                                  #Requires PackageType 'Image'

--location|-l                     #Custom scaffolding DIR, among:
                                  #  - 'DIR'
                                  #  - 'PATH.zip'
                                  #  - 'URI.zip'
                                  #  - 'gh:USER/REPO'
                                  #  - 'git+ssh://git@github.com/USER/REPO.git'
                                  #Runs cookiecutter, providing there is a cookiecutter.json
                                  #Ignores --runtime, --package-type, --base-image, --dependency-manager

--[no-]structured-logging         #BOOL (def: false). Sets TEMPLATE.Globals:
                                  #  - Function.LoggingConfig.LogFormat 'JSON'
--[no-]tracing                    #BOOL (def: false). Sets TEMPLATE.Globals:
                                  #  - Function.Tracing 'Active'
                                  #  - Api.TracingEnabled true
--[no-]application-insights       #BOOL (def: false). Enable CloudWatch Application Insights monitoring by setting TEMPLATE.Resources:
                                  #  - 'ApplicationResourceGroup':
                                  #     - RESTYPE AWS::ResourceGroups::Group
                                  #     - Name 'ApplicationInsights-SAM-STACK'
                                  #     - ResourceQuery.Type 'CLOUDFORMATION_STACK_1_0'
                                  #  - 'ApplicationInsightsMonitoring':
                                  #     - RESTYPE AWS::ApplicationInsights::Application
                                  #     - ResourceGroupName {Ref: RESOURCE_GROUP}
                                  #     - AutoConfigurationEnabled true

                                  ┌──────────────────┐
                                  │   STACK CREATE   │
                                  └──────────────────┘

sam deploy                        #Upserts a STACK, in a production stage
--guided|-g                       #Interactive mode
                                  #Does not work with --[no-]resolve-s3
--[no-]confirm-changeset          #BOOL (def: false, recommended: true). Confirm before deploying, after showing diff
--no-execute-changeset            #BOOL. If false (def), use a CHANGESET
--[no-]fail-on-empty-changeset    #BOOL (def: true). Non-zero exit code if no STACK changes

sam deploy|sync
--capabilities                    #STACK.Capabilities (recommended: 'CAPABILITY_IAM')
--notification-arns               #STACK.NotificationARNs
--tags                            #'TAG=VAL ...'. STACK.Tags
--role-arn                        #'ROLE_ARN' executing CHANGESET

sam deploy
--on-failure                      #STACK.OnFailure
--[no-]disable-rollback           #BOOL (def: false). STACK.DisableRollback
--max-wait-duration               #NUM (in mins). Deployment timeout

ENVVAR SAM_CLI_POLL_DELAY         #NUM (in secs, def: 5). How often to poll with DescribeStack() WAIT

                                  ┌──────────────────┐
                                  │   STACK UPDATE   │
                                  └──────────────────┘

sam sync                          #Update STACK, in a development stage
                                  #Uses a CHANGESET
--[no-]watch                      #BOOL (def: false, recommended: true). Re-perform when local file changes
--watch-exclude                   #'[NESTED_STACK/]RESOURCE=FILE|DIR' to not watch
--[no-]skip-deploy-sync           #BOOL (def: false). Do not sync bootstrap STACK if TEMPLATE did not change
--[no-]dependency-layer           #BOOL (def: false). Put FUNCTION dependencies into a LAYER
                                  #No dependencies installed|restored in BUILD_DIR
--resource-id                     #'[NESTED_STACK/]RESOURCE'. Only sync that RESOURCE
--resource                        #Same using RESTYPEs among:
                                  #  - AWS::Serverless|Lambda::Function|LayerVersion
                                  #  - AWS::Serverless|ApiGatewyaV2::Api, AWS::Serverless:HttpApi, AWS::ApiGatewayV2::Api
                                  #  - AWS::Serverless|StepFunctions::StateMachine
--code                            #Same using all the above RESTYPEs

GLOBAL_CONFIG                     #BOOL. If false (def), confirm that a development stage is used
 .accelerateOptInStacks           #Set to MD5('TEMPLATE_PATH' + 'STACK') after the confirmation

                                  ┌──────────────────┐
                                  │   STACK DELETE   │
                                  └──────────────────┘

sam delete                        #Delete STACK
--no-prompts                      #BOOL. If false (def), interactive

                                  ┌────────────────┐
                                  │   STACK INFO   │
                                  └────────────────┘

sam list
--output                          #Either 'table' (def) or 'json'
sam list resources                #Print all STACK_RESOURCEs
sam list stack-outputs            #Print all STACK_OUTPUTs
sam list endpoints                #Print Lambda and API Gateway local|remote URIs

                                  ┌───────────┐
                                  │   BUILD   │
                                  └───────────┘

sam build [FUNCTION|LAYER]        #Build AWS::Serverless|Lambda::Function|LayerVersion
                                  #Does package|runtime-related build step:
                                  #  - e.g. `npm pack`, `npm install`, `esbuild`, `go build`
                                  #  - not other build logic like `tsc`, `babel`, etc., which must be performed before
                                  #Def FUNCTION|LAYER: all
                                  #Run by `sam deploy|sync`???
--exclude|-x                      #'FUNCTION|LAYER' to exclude

SOURCE_DIR                        #FUNCTION|LAYER's 'DIR' specified as RESPROP
BUILD_DIR                         #'BASE_BUILD_DIR/FUNCTION|LAYER'
                                  #SOURCE_DIR is copied, transformed and output to BUILD_DIR
                                  #Re-created on each build
sam build
--build-dir|-c                    #'BASE_BUILD_DIR' (def: './.aws-sam/build/')
sam build|sync
--base-dir|-s                     #'DIR' (def: TEMPLATE's DIR) used to resolve relative PATHs in TEMPLATE
                                  #Only for properties used by `sam build`, not `sam package`, except those used by both (e.g. FUNCTION.Code 'PATH')

sam build
--parallel|-p                     #BOOL (def: false, recommended: true). Build all FUNCTIONs|LAYERs in parallel

sam build
--[no-]cached|-c                  #BOOL (def: false, recommended: true). Cache dependencies (e.g. node_modules), avoiding install step
                                  #Note: cached dependencies are not invalidated when new versions are available
--cache-dir|-cd                   #Cache 'DIR' (def: ./.aws-sam/cache/). When is it used???
./.aws-sam/deps                   #Contains cached dependencies, e.g. node_modules
 /FUNCTION_UUID|LAYER_UUID        #Only if --cached

sam build|sync
--[no-]build-in-source            #Update|re-use dependencies inside SOURCE_DIR
                                  #As opposed to installing them fresh inside BUILD_DIR
                                  #Symlink BUILD_DIR's dependencies to SOURCE_DIR's
                                  #Depending on BuildMethod:
                                  #  - 'go*', 'rust*', 'dotnet*': always true
                                  #  - 'python*', 'java*', 'ruby*': always false
                                  #  - 'node*', 'esbuild', 'provided*|makefile': can be false (def) or true
                                  #     - 'esbuild' implies --no-cached

sam build
--manifest|-m                     #'PATH' to RUNTIME-specific dependencies manifest
                                  #Def: SOURCE_DIR/FILENAME with FILENAME depending on BuildMethod:
                                  #  - 'nodejsX.x' or 'esbuild': use package.json
                                  #  - 'pythonX.Y': requirements.txt
                                  #  - 'rubyX.x': Gemfile
                                  #  - 'goX.x': go.mod
                                  #  - 'javaX': either build.gradle[.kts] or pom.xml
                                  #  - 'dotnet[X]': .csproj
                                  #  - 'provided[.al2|al2023]' or 'makefile': Makefile
                                  #  - 'rust-cargolambda': Cargo.toml

RESOURCE.Metadata.Build*          #BUILD_METADATA. Only with AWS::Serverless|Lambda::Function|LayerVersion
                                  #Only if PackageType Zip
                                  #Done even if not set
                                  #Not done if already zipped: FUNCTION.Code[Uri][.ZipFile] 'PATH.zip' or FUNCTION.InlineCode set
BUILD_METADATA.BuildMethod        #Can be:
                                  #  - 'nodejsX.x'
                                  #  - 'esbuild'
                                  #  - 'pythonX.Y'
                                  #  - 'rubyX.x'
                                  #  - 'goX.x'
                                  #  - 'javaX'
                                  #  - 'dotnet[X]'
                                  #  - 'provided[.al2|al2023]' or 'makefile': use Makefile
                                  #  - 'rust-cargolambda':
                                  #     - uses RUNTIME 'rust' (which is deprecated)
                                  #     - must set GLOBAL_CONFIG.experimentalCargoLambda or ENVVAR SAM_CLI_BETA_RUST_CARGO_LAMBDA true
                                  #Def: guessed based on RUNTIME
                                  #  - for Node.js: 'nodejsX.x', not 'esbuild'
                                  #Currently, this documentation only describes nodejs* and esbuild
                                  #Based on a Python library called aws-lambda-builders

BUILDMETHOD NODE ==>              #Included|excluded files:
                                  #  - uses PACKAGE.files and .npmignore (with `npm pack` under-the-hood)
                                  #  - includes package-lock.json, npm-shrinkwrap.json
                                  #  - includes .npmrc but deletes at end
                                  #  - excludes .git/, .aws-sam/
                                  #Runs `npm install --production`
BUILD_PROPS.UseNpmCi              #BOOL (def: false). Use `npm ci` instead
                                  #Always false if no package-lock.json nor npm-shrinkwrap.json
                                  #Only with BuildMethod 'node*' or 'esbuild'

BUILDMETHOD ESBUILD ==>           #Like Node.js, but runs `esbuild` after dependencies are installed|restored
                                  #Must install `esbuild` as a dependency
ESBUILD_PROPS.*                   #BUILD_PROPS.* with BuildMethod 'esbuild'
ESBUILD_PROPS.EntryPoints         #'PATH'_ARR (def: 'HANDLER')
ESBUILD_PROPS.FLAG                #VAL. FLAG is in PascalCase. `esbuild --FLAG`
                                  #Flags always used: --bundle --platform=node
                                  #Default flags: --target=es2020 --format=cjs --minify
ESBUILD_PROPS.External            #STR_ARR (def: []). `esbuild --external`.
                                  #Special STR value './node_modules/*':
                                  #  - does --external for each PACKAGE.dependencies
                                  #  - i.e. does not bundle node_modules

BUILD_METADATA.BuildProperties    #BUILD_PROPS
BUILD_PROPS.*                     #Some BuildMethods have specific additional options
BUILD_PROPS.Sourcemap             #BOOL (def: false). ???

BUILD_METADATA                    #Main 'DIR', used instead of 'SOURCE_DIR'
 .ProjectRootDirectory            #Only with BuildMethod 'provided*'
BUILD_METADATA.ContextPath        #'DIR' containing Makefile, used instead of 'SOURCE_DIR'
                                  #Only with BuildMethod 'provided*'

RESOURCE.Metadata.Docker*         #DOCKER_METADATA. Only with AWS::Serverless|Lambda::Function|LayerVersion
                                  #Only if PackageType Image
                                  #If set, runs `docker build`
                                  #  - `--architecture linux/arm64|amd64` depending on FUNC_VERSION.Architectures or LAYER_VERSION.CompatibleArchitectures
                                  #Not used if ImageUri is 'PATH.tar' (from `docker save`): use `docker load` instead
                                  #'FUNCTION|LAYER' is used as image name
DOCKER_METADATA.Dockerfile        #'PATH'. Required
DOCKER_METADATA.DockerContext     #'DIR'. Required
DOCKER_METADATA.DockerBuildArgs   #OBJ (def: {}). `docker build --build-arg VAR=VAL`
DOCKER_METADATA.DockerBuildTarget #STR (def: none). `docker build --target STR`
DOCKER_METADATA.DockerTag         #'TAG' (def: 'latest'). `docker build --tag TAG`

sam build|sync
--use-container|-u                #Custom build logic
                                  #Alternative to BuildMethod, using a Docker container
                                  #Not if PackageType Image
                                  #  - difference is not use to run the FUNCTION, just to build its DIR to zip
                                  #Ignores --cached and --build-in-source (others???)
--build-image|-bi                 #'[FUNCTION|LAYER.]URI'. Container image
public.ecr.aws/sam/build-RUNTIME  #Default value for --build-image
 [:latest|X.Y.Z[-CPU_ARCH]]       #X.Y.Z is SAM CLI's version
                                  #Based on public.ecr.aws/lambda/nodejs:20-CPU_ARCH
                                  #Has aws CLI and sam CLI
                                  #Executes Bash command passed as argument

sam build
--container-env-var|-e            #'[FUNCTION|LAYER.]ENVVAR=VAL' passed to container
--container-env-var-file|-ef      #Same but as 'PATH.json' containing { FUNCTION|LAYER|Parameters: { ENVVAR: 'VAL',... },... }
--mount-with|-mw                  #'READ' (def) or 'WRITE'. Allow containing to write to SOURCE_DIR
                                  #Only needed with DotNet BuildMethod???
--skip-pull-image
ENVVAR SAM_SKIP_PULL_IMAGE        #BOOL. If false (def), use latest container image for Lambda SDK
--docker-network
ENVVAR SAM_DOCKER_NETWORK         #Docker 'NETWORK_NAME' (def: bridge)

./.aws-sam/build.toml             #BUILD_MANIFEST. Automatically generated by `sam build`
                                  #Has information about each FUNCTION|LAYER having been built
BUILD_MANIFEST
 .function_build_definitions      #FUNCTION_MANIFEST
 .FUNCTION_UUID                   #UUID is generated for each build
FUNCTION_MANIFEST.functions       #'FUNCTION'_ARR
FUNCTION_MANIFEST.codeuri         #'SOURCE_DIR'
FUNCTION_MANIFEST.runtime         #FUNC_VERSION.Runtime
FUNCTION_MANIFEST.packagetype     #FUNC_VERSION.PackageType
FUNCTION_MANIFEST.architecture    #FUNC_VERSION.Architectures[0]
FUNCTION_MANIFEST.handler         #FUNC_VERSION.Handler
FUNCTION_MANIFEST.env_vars        #OBJ???
FUNCTION_MANIFEST.metadata        #OBJ???
FUNCTION_MANIFEST.source_hash     #STR???
FUNCTION_MANIFEST.manifest_hash   #STR???

BUILD_MANIFEST
 .layer_build_definitions
 .LAYER_UUID                      #LAYER_MANIFEST
LAYER_MANIFEST.layer_name         #'LAYER'
LAYER_MANIFEST.codeuri
 |architecture|env_vars
 |source_hash|manifest_hash       #Same as FUNCTION_MANIFEST.*
LAYER_MANIFEST.build_method       #???
LAYER_MANIFEST.compatible_runtimes#LAYER_VERSION.CompatibleRuntimes

GLOBAL_CONFIG
 .experimentalBuildPerformance
ENVVAR
 SAM_CLI_BETA_BUILD_PERFORMANCE   #BOOL (def: false). ???
                                  #If multiple FUNCTIONs, appends "...-Shared" to each ./.aws-sam/build/FUNCTION|LAYER filename

ENVVAR SAM_BUILD_MODE=debug???
  - '-debug' appended to Docker Image TAG, when using DOCKER_METADATA

resources_to_build:
  - all Function() and LayerVersion() (AWS::Lambda|Serverless::LayerVersion)
  - filtered by sam build [FUNCTION|LAYER] argument
     - FUNCTION includes all its LAYERs (if buildable themselves and not excluded)
  - except ones from --exclude
  - only ones with 'BuildableZip' or 'BuildableImage'
Locates each FUNCTION.Layers
  - including in nested STACKs, but only with `sam sync` (not `sam build`)
SamFunctionProvider():
  - self.functions.RESOURCE_PATH Function() for all AWS::Lambda|Serverless::Function in TEMPLATE
LayerVersion()
Function():
  - function_id 'FUNCTION'
  - codeuri: RESPROP Code (or CodeUri if AWS::Serverless::Function) if PackageType Zip:
     - 'PATH': as is
     - undefined: '.'
     - OBJ (e.g. {ZipFile}): None
  - imageuri: RESPROP Code.ImageUri (or ImageUri if AWS::Serverless::Function)
  - layers are LayerVersion(), but unlike resources_to_build:
     - no compatible_architectures
     - no codeuri, compatible_runtimes, metadata if 'PATH' (as opposed to {Ref})
  - others: RESPROPs
  - function_build_info:
     (PackageType Zip)
     - 'InlineCode' if RESPROP InlineCode (only for AWS::Serverless::Function) or Code.ZipFile (for AWS::Lambda::Function)
     - 'PreZipped' if Code 'PATH.zip'
     - 'SkipBuild': CDK HFOPTS.bundling was used
     - 'BuildableZip': else
     (PackageType Image)
     - 'BuildableImage': has Metadata.Dockerfile + DockerContext
     - 'NonBuildableImage': else
`result` of `_build_function()` is Docker 'IMAGE:TAG' if Image

                                  ┌────────────┐
                                  │   ASSETS   │
                                  └────────────┘

sam package                       #Uploads to S3 any local 'PATH.zip' in TEMPLATE:
                                  #  - replaced by S3 URL|OBJ, depending on RESPROP
                                  #  - 'OBJECT' name is contents hash
                                  #Also uploads to ECR any local image in TEMPLATE:
                                  #  - value is either:
                                  #     - 'DIR' with Dockerfile
                                  #     - local 'REPO:TAG'
                                  #     - local 'sha256:HASH'
                                  #  - replaced by ECR IMAGE URL
                                  #  - uses same TAG, but replaces : by -
                                  #  - only for AWS::Serverless|Lambda::Function ImageUri
                                  #Special RESTYPEs:
                                  #  - AWS::CloudFormation::Stack[Set] TemplateURL, AWS::Serverless::Application Location
                                  #     - value must be 'PATH' (not 'PATH.zip')
                                  #     - with `sam build`, has to be 'PATH', not 'URL' nor OBJ
                                  #  - TEMPLATE.Metadata['AWS::ServerlessRepo::Application'].LicenseUrl|ReadmeUrl:
                                  #     - value must be 'PATH' (not 'PATH.zip')
                                  #  - AWS::Serverless|Lambda::Function|LayerVersion CodeUri:
                                  #     - value must be 'DIR' (not 'PATH.zip')
                                  #     - S3 'OBJECT' name is hash of all contents + filenames
                                  #     - with `sam build`, should be 'PATH', not URL
                                  #  - AWS::Serverless::Function|GraphQLApi: noop if [**.]InlineCode used
                                  #  - AWS::Serverless::GraphQLApi: uses Resolvers|Functions.**.CodeUri
                                  #  - AWS::ECR::Repository RepositoryName: no upload, only deletes with `sam delete`
                                  #Noop if RESPROP value is not set, or is already a S3|ECR URL
                                  #Only for specific RESPROPs on specific RESTYPEs, documented in their respective docs
                                  #Other TEMPLATE transformations:
                                  #  - removes YAML comments
                                  #  - adds RESOURCE.Metadata.SamResourceId
                                  #Run by `sam deploy`???
                                  #Does not build, i.e. must be run after `sam build`???
--output-template-file            #'PATH' (def: stdout) of the transformed TEMPLATE

sam package|deploy
--use-json                        #Instead of YAML, for transformed TEMPLATEs
--no-progressbar                  #BOOL. If false (def), progress bar while uploading to S3|ECR

RESOURCE.Metadata.SamResourceId   #Original 'RESOURCE'
                                  #Set by `sam package`. Used internally

                                  ┌───────────────┐
                                  │   S3 ASSETS   │
                                  └───────────────┘

sam package|deploy|sync|delete
--s3-bucket                       #S3 'BUCKET' for `sam package` and TEMPLATE themselves
--s3-prefix                       #S3 virtual 'FOLDER' (def: none)

sam package|deploy
--[no-]resolve-s3                 #BOOL (def: false, recommended: true)
                                  #Automatically create S3 BUCKET instead of using --s3-bucket
                                  #Does it by creating a bootstrap STACK 'aws-sam-cli-managed-default' with BUCKET using:
                                  #  - SSE-KMS
                                  #  - VERSIONING
                                  #  - BUCKET_POLICY allowing GetObject() from SERVICE serverlessrepo.amazonaws.com (if same ACCOUNT)
                                  #  - TAG 'ManagedStackSource' with value 'AwsSamCli'
                                  #     - on STACK too
--force-upload                    #BOOL (def: false). Re-upload S3 OBJECT even if already exists with same contents
--signing-profiles                #'FUNCTION|LAYER=SIGNING_PROFILE[:OWNER]'
                                  #Lambda FUNC_VERSION|LAYER_VERSION_OUTPUT.SigningProfileVersionArn
                                  #Automatically sign with CodeSigner

sam package|deploy|sync
--kms-key-id                      #S3 'KMS_KEY_MID' (def: uses SSE-S3)
--metadata                        #'OBJ_JSON' or 'VAR=VAL,...'. S3 x-amz-meta-* [C]

sam pipeline bootstrap
--bucket                          #Like --s3-bucket

                                  ┌────────────────┐
                                  │   ECR ASSETS   │
                                  └────────────────┘

sam package|deploy|sync
--image-repository                #ECR 'REPO[_URL]' for `sam package`
                                  #IMAGEs use 'RESOURCE' as name
--image-repositories              #Same but as '[NESTED_STACK/]FUNCTION=REPO'

sam deploy
--resolve-image-repos             #BOOL (def: false, recommended: true)
                                  #Automatically create|delete one ECR REPO for each FUNCTION instead of using --image-repositories

sam pipeline bootstrap
--image-repository                #Same but using REPO_ARN
--[no-]create-image-repository    #BOOL (def: false). Automatically creates ECR REPO for all FUNCTIONs instead of using --image-repository

                                  ┌────────────────────┐
                                  │   CI/CD PIPELINE   │
                                  └────────────────────┘

sam pipeline bootstrap            #Create|deploy RESOURCEs needed for CI/CD

--[no-]confirm-changeset          #Like sam deploy
--[no-]interactive                #BOOL (def: false). Interactive mode

--stage                           #STR prefixing all RESOURCE names
                                  #Similar to CDK STAGE

--pipeline-user                   #IAM USER_ARN used by CI/CD provider to call CloudFormation
                                  #Must share ACCESS_KEY_ID and SECRET_ACCESS_KEY with CI/CD provider
                                  #Def: use short-term CREDS
--permissions-provider            #Either:
                                  #  - 'iam' (def): use --pipeline-user
                                  #  - 'oidc': use OIDC
--pipeline-execution-role         #ROLE_ARN (def: automatically created) used by CI/CD provider to call CloudFormation
--cloudformation-execution-role   #ROLE_ARN (def: automatically created) used as STACK.RoleARN, i.e. for CloudFormation to provision

--cicd-provider                   #Can be 'github-actions', 'gitlab', 'bitbucket-pipelines' or 'oidc'

--github-org                      #GitHub 'USER'
--github-repo                     #GitHub 'REPO'
--deployment-branch               #Git 'BRANCH'. Only with GitHub actions

--gitlab-group                    #GitLab 'USER'
--gitlab-project                  #GitLab 'REPO'

--bitbucket-repo-uuid             #BitBucket REPO UUID

--oidc-provider                   #Same values as --cicd-provider, except 'oidc'
                                  #To set when using --cicd-provider 'oidc'
--oidc-provider-url               #'URL' of OIDC provider
--oidc-client-id                  #'CLIENT_ID' with OIDC

sam pipeline init                 #Creates CI/CD configuration file, e.g. GitHub actions workflows
--bootstrap                       #Also runs sam pipeline bootstrap --interactive

                                  ┌──────────────────┐
                                  │   LOCAL INVOKE   │
                                  └──────────────────┘

sam local invoke [FUNCTION]       #Invoke Lambda FUNCTION locally (emulation)

--event|-e                        #'PATH.json' or '-' (stdin) to REQ
                                  #Def: no REQ
--env-vars|-n                     #'PATH.json' with ENVVARs to pass to FUNCTION

--shutdown                        #Emulate FUNC_INSTANCE shutdown after invocation
                                  #Meant to test Lambda extensions' shutdown behavior

--log-file|-l                     #'PATH' (def: stdout) for FUNCTION logs

--layer-cache-basedir             #Cache 'DIR' for LAYERs

--debug-port|-d                   #PORT_NUM. Start debugger in localhost:PORT_NUM
--debugger-path                   #'PATH' to debugger command
--debug-args                      #Debugger 'ARG ...'

--container-env-vars
--skip-pull-image
--docker-network                  #Like sam build
--force-image-build               #Unless set, do not rebuild container image unless has changed
--docker-volume-basedir|-v        #'DIR' of the TEMPLATE ???
--invoke-image|-ii                #Like sam build --build-image
--container-host                  #'HOST' (def: 'localhost') of container
--container-host-interface        #'NETWORK_IP' (def: '127.0.0.1') of container
                                  #Can be '0.0.0.0'
--add-host                        #'HOST:IP' added to container's host file

                                  ┌───────────────┐
                                  │   LOCAL API   │
                                  └───────────────┘

sam local start-lambda            #Start local server with Lambda FUNCTION
--FLAG                            #Like sam local invoke, except no --event
--host                            #'HOST' (def: '127.0.0.1')
--port|-p                         #PORT_NUM (def: 3001)
--warm-containers                 #Whether to load FUNCTIONs:
                                  #  - 'EAGER' (recommended): right away
                                  #  - 'LAZY' (def): on first invocation

sam local start-api               #Same as start-lambda???
                                  #Seems to use AWS::Serverless::Function CodeUri
                                  #Seems to live reload
--FLAG                            #Like sam local start-lambda
--disable-authorizer              #Ignore Lambda AUTHORIZERs
--static-dir|-s                   #'DIR'. Serve DIR as static files at /
--ssl-cert-file                   #'PATH' (def: none) to SSL certificate
--ssl-key-file                    #'PATH' (def: none) to SSL key

                                  ┌─────────────────┐
                                  │   LOCAL EVENT   │
                                  └─────────────────┘

sam local generate-event          #Scaffolds a test REQ for a given SERVICE + ACTION
 SERVICE ACTION                   #Only for specific SERVICEs|ACTIONs
--FLAG                            #Like sam local invoke, except no --event
--PARAM                           #ACTION-specific parameters
                                  #Def: dummy ones

                                  ┌────────────┐
                                  │   INVOKE   │
                                  └────────────┘

sam remote invoke [RESOURCE|ARN]  #Invoke RESOURCE in AWS
                                  #Can be Lambda FUNCTION, Step Function, SQS QUEUE, Kinesis data stream
--output                          #Either 'text' (def) or 'json'
                                  #Response printed to stdout
                                  #Logs (Lambda or Step Functions) printed to stderr
--event|-e                        #Input among:
                                  #  - Lambda: REQ
                                  #  - Step Functions: Input
                                  #  - SQS: MessageBody
                                  #  - Kinesis: Data
--event-file                      #Same but as 'FILE' or '-' (stdin)
--test-event-name                 #'TEST_EVENT' to use as Lambda REQ
--parameter                       #'PARAM=VAL ...' among:
                                  #  - Lambda: Qualifier, INVOCATION_REQ.InvocationType|ClientContext|LogType
                                  #  - Step Functions: name STR, traceHeader STR
                                  #  - SQS: DelaySeconds NUM, Message[System]Attributes 'JSON', MessageDeduplicationId STR, MessageGroupId STR
                                  #  - Kinesis: PartitionKey STR, ExplicitHashKey STR, SequenceNumberForOrdering STR, StreamARN STR

                                  ┌────────────────┐
                                  │   TEST EVENT   │
                                  └────────────────┘

sam remote test-event
 put|list|get|delete
 [FUNCTION|ARN]                   #CRUD for Lambda TEST_EVENTs

sam remote test-event
 put|get|delete
--name                            #'TEST_EVENT'

sam remote test-event put         #
--file                            #'PATH.json' or '-' (stdin) with REQ input
--force|-f                        #Unless set, fails if TEST_EVENT already exists

sam remote test-event get         #
--output-file                     #'PATH.json' for REQ output

                                  ┌──────────┐
                                  │   LOGS   │
                                  └──────────┘

sam logs                          #Prints Cloudwatch logs, including ones from Lambda

--name|-n                         #'[NESTED_STACK/]RESOURCE' (e.g. 'FUNCTION') (def: all)
--cw-log-group                    #'LOG_GROUP' (def: guessed from --name)

--filter                          #'FILTER_PATTERN'. LLEVENTS_REQ.filterPattern
--start-time|-s                   #'DATE' or words like 'yesterday' or '5mins ago'. LLEVENTS_REQ.startTime
                                  #Def: '10mins ago'
--end-time|-e                     #Same for LLEVENTS_REQ.endTime
                                  #Def: now
--tail|-r                         #Live tail

--output                          #Either 'text' (def) or 'json'

                                  ┌────────────┐
                                  │   TRACES   │
                                  └────────────┘

sam traces                        #Print X-Ray traces
--trace-id|-ti                    #'TRACE_ID' (def: any)
--tail|-r
--start-time|-s
--end-time|-e
--output                          #Like sam logs

sam logs
--include-traces|-i               #Also print X-Ray traces

                                  ┌─────────┐
                                  │   CDK   │
                                  └─────────┘

DETECTION ==>                     #If any of the following exists:
                                  #  - RESOURCE AWS::CDK::Metadata
                                  #  - RESOURCE.Metadata['aws:cdk:path']
                                  #  - ./manifest.json
                                  #  - ./tree.json
                                  #  - ./cdk.json

FORBIDDEN COMMANDS ==>            #If CDK, cannot use sam validate|package|deploy|sync

sam build                         #Does not build if HFOPTS.bundling was used

sam package                       #Handles ASSETs already built by CDK, based on RESOURCE.Metadata['aws:asset:*']
                                  #Replaces RESPROP with PATH to built file
                                  #Sets RESOURCE.Metadata.SamResourceId using aws:asset:path
                                  #If Code.fromAssetImage(), sets RESOURCE.Metadata.Docker*
                                  #Do not build if HFOPTS.bundling was used

                                  ┌───────────────┐
                                  │   TERRAFORM   │
                                  └───────────────┘

sam build|local
--hook-name                       #'SAM_BUILD_PLUGIN'
                                  #Only available one: 'terraform', to support Terraform templates
--[skip-]prepare-infra            #BOOL (def: true). Run preparation logic even if no STACK changes
                                  #Only with --hook-name

sam build
--terraform-project-root-path     #Terraform root 'DIR' (def: .)

sam local
--terraform-plan-file PATH        #Terraform plan 'PATH'

GLOBAL_CONFIG
 .experimentalTerraformSupport
ENVVAR
 SAM_CLI_BETA_TERRAFORM_SUPPORT   #BOOL (def: false). ???
