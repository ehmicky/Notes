
           
   AWS API  
           



VERSION ==>                   #2023-04-04

SEE ALSO ==>                  #Main AWS doc


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:            REQUEST            :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PROTOCOL ==>                  #HTTPS
                              #HTTP allowed for some SERVICEs

HTTP METHOD ==>               #Either GET|POST, for any ACTION

Content-Type [C|S]            #Depending on SERVICE:
                              #  - none: query variables (REQ only)
                              #  - application/x-www-form-urlencoded
                              #  - applicaion/json
                              #  - XML
                              #VAL_ARR:
                              #  - query variable: VAR.NUM. (1-based)
                              #  - urlencoded: VAR.NUM. (1-based)
                              #  - XML: <KEYSet|KEYList><VAR></VAR>...</KEYSet|KEYList>
Content-Length [C|S]          #

REQ                           #Request parameters

REQ.Action                    #ACTION
REQ.Version                   #'YYYY-MM-DD'. Service API version

REQ.DryRun                    #BOOL. Checks authorization without doing anything.
                              #Returns DryRunOperation if no problem, UnauthorizedOperation otherwise.

REQ.ClientToken               #STR. Do not perform if already performed with same STR.
                              #Meant for idempotence.

RETRIES ==>                   #Should retry on 5**, with exponential backoff
amz-sdk-request [C]           #'attempt=NUM; max=NUM' of retries
                              #Optional. Set by multiple SDKs
amz-sdk-invocation-id [C]     #'UUID' not changed when doing retries
                              #Optional. Set by multiple SDKs

x-amz-user-agent [C]          #Optional. Set by multiple SDKs


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           RESPONSE            :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


Connection [S]                #
Date [S]                      #
Server [S]                    #'AmazonS3'
ETag [S]                      #MD5. Of content, not metadata.

RES                           #Response body

RES.Errors                    #OBJ_ARR: Code STR, Message STR

REQ_ID                        #'UUID'. Depending on SERVICE:
                              #  - RES.requestId
                              #  - x-amzn-request-id [S]

EVENTUAL CONSISTENCY ==>      #After change, should test existence, with exponential retry delays up to a limit (e.g. 5 mins)
                              #Can be slow, i.e. avoid in critical paths


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           TRUE REST           :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


TRUE REST API ==>             #Some SERVICEs use different API conventions, closer to true REST

HTTP METHOD ==>               #Any

PATH ==>                      #Represents the ACTION
                              #Present in my documentation
REQ.Action                    #Not used

HEADERS ==>                   #X-Amz-HEADER -> HEADER

RES.Errors                    #OBJ_ARR: Code STR, Message STR, Resource STR, RequestId STR

ONLY FOR S3 ==>               #
Content-MD5 [C]               #
X-Amz-Content-SHA256 [C]      #'SHA256' hash of request body


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:         AUTHORIZATION         :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


AUTHORIZATION ==>             #Only when using ACCESS_KEY (not LOGIN_PROFILE, or other credentials)
                              #Signed checksum include: ACTION, full request, date, REGION

VERSION 4 SIGNATURE A ==>     #
REQ.X-Amz-Algorithm           #'AWS4-HMAC-SHA256'
REQ.X-Amz-Credential          #'ACCESS_KEY_ID/YYYYMMDD/REGION/SERVICE/aws4_request'
REQ.X-Amz-SignedHeaders       #'HEADER'_ARR among: Host|Content-Type|Content-Length|Range|[X-]Amz-*
REQ.X-Amz-Signature           #'HMAC_SHA256':
                              #  - of:
                              #     - 'AWS4-HMAC-SHA256'
                              #     - 'DATE'
                              #     - 'YYYYMMDD/REGION/SERVICE/aws4_request'
                              #     - 'SHA256' of:
                              #        - HTTP method
                              #        - URI path
                              #           - URI encoded unless S3
                              #        - query string
                              #        - all headers, sorted, name + values
                              #        - only signed headers, sorted, only names
                              #        - 'SHA256' of request body
                              #  - signed with 'HMAC_SHA256'
                              #     - of:
                              #        - 'YYYYMMDD'
                              #        - 'REGION'
                              #        - 'SERVICE'
                              #        - 'aws4_request'
                              #     - signed with 'AWS4' + SECRET_ACCESS_KEY
REQ.X-Amz-SecurityToken       #STS 'SESSION_TOKEN'
REQ.X-Amz-Date                #'DATE'

VERSION 4 SIGNATURE B ==>     #Alternative
Authorization:
 AWS4-HMAC-SHA256
 AUTH_VAR=VAL,... [C]         #
AUTH_VAR Credential
AUTH_VAR SignedHeaders
AUTH_VAR Signature
X-Amz-SecurityToken [C]
X-Amz-Date [C]                #Same as above

VERSION 2 SIGNATURE ==>       #Only for SimpleDB
REQ.AWSAccessKeyId            #ACCESS_KEY_ID
REQ.SignatureVersion          #2
REQ.SignatureMethod           #'HmacSHA256'
REQ.Signature                 #'HMAC_SHA256':
                              #  - of:
                              #     - HTTP method
                              #     - 'SERVICE_DOMAIN'
                              #     - URI path
                              #     - all request parameters, sorted
                              #        - including AWSAccessKkeyId, Action, SignatureMethod, SignatureVersion, Timestamp
                              #  - signed with SECRET_ACCESS_KEY
REQ.SecurityToken             #STS 'SESSION_TOKEN'
REQ.Timestamp                 #'DATE'
