
                   
   CLOUDWATCH_LOGS  
                   



TODO ==>
  - CloudTrail: see unfinished "CloudWatch logs" chapter
  - CloudWatch metrics:
     - embedded metrics: https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Embedded_Metric_Format.html
     - best practices: https://docs.aws.amazon.com/securityhub/latest/userguide/cloudwatch-controls.html
  - CloudWatch dashboard:
     - DLOG
  - Lambda:
     - https://docs.aws.amazon.com/lambda/latest/dg/urls-monitoring.html
     - https://docs.aws.amazon.com/lambda/latest/dg/nodejs-logging.html
     - https://docs.aws.amazon.com/lambda/latest/dg/monitoring-cloudwatchlogs.html
     - ENVVAR AWS_LAMBDA_LOG_GROUP_NAME, AWS_LAMBDA_LOG_STREAM_NAME
     - Insights:
        - https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Lambda-Insights-metrics.html (second half of page)
        - https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Lambda-Insights-Troubleshooting.html
        - https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Lambda-Insights-example-event.html

Read:
  - Working with log groups and log streams
     - Use Live Tail to view logs in near real time
     - Search log data using filter patterns
  - Creating metrics from log events using filters

GOAL ==>                      #Aggregates logs to single place, with rotation, and possibility to create CloudWatch alarms when log line match pattern

VERSION ==>                   #2023-07-17


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:              API              :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


SERVICE_DOMAIN                #logs.amazonaws.com
                              #Can use HTTP[S]

FORMAT ==>                    #JSON
                              #Uses REQ.Action|Version

REQ_ID                        #x-amzn-RequestId [S]

PAGINATION ==>                #REQ.limit NUM (def|max: 50) + REQ|RES.nextToken except:
                              #  - def|max 1e4: StartQuery()
                              #  - def|max 1e4 or 1MB: GetLogEvents|FilterLogEvents()
                              #  - def|max 1e4 and use RES.nextBackwardToken|nextForwardToken: GetLogEvents()
                              #  - def|max 1e3 and use REQ.maxResults: DescribeQueries|QueryDefinitions()
                              #  - no pagination: DescribeAccountPolicies(), GetLogGroupFields(), TestMetricFilter()

THROTTLING ==>                #Max:
                              #  - 50 requests/sec: CreateLogStream()
                              #  - 5 requests/sec: DescribeLogStreams()

PRICING ==>                   #  - 0.5$/GB read
                              #  - 0.03$/GB stored
                              #  - GetLogEvents(): same price as out traffic on EC2

CloudWatchLogsFullAccess      #AWS managed POLICY allowing logs:*
CloudWatchLogsReadOnlyAccess  #Same but readonly


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:             GROUP             :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


CreateLogGroup()              #Req:
                              #  - only logGroupName, kmsKeyId
                              #Res: empty
PutRetentionPolicy()          #Req:
                              #  - only logGroupName, retentionInDays
                              #Res: empty
DeleteRetentionPolicy()       #Req:
                              #  - only logGroupName
                              #Res: empty
DescribeLogGroups()           #Req LOG_GROUP_REQ
                              #Res: logGroups LOG_GROUP_ARR
                              #  - no tags
                              #  - only arn|logGroupName|creationTime if logGroupNamePattern used
DeleteLogGroup()              #Req:
                              #  - only logGroupName
                              #Res: empty

LOG_GROUP                     #Group of LOG_STREAMs
                              #Max 2e4
LOG_GROUP.arn                 #LOG_GROUP_ARN. arn:aws:logs:REGION:ACCOUNT_ID:log-group:LOG_GROUP
LOG_GROUP.logGroupName        #'LOG_GROUP'. Max 512 chars, [[:alnum:]_-/.#]
                              #Can include a NAMEPATH
LOG_GROUP_REQ
 .logGroupNamePrefix          #STR. Filter logGroupName that start with STR
LOG_GROUP_REQ
 .logGroupNamePattern         #STR. Filter logGroupName that include STR, case-insensitively
LOG_GROUP.creationTime        #DATE_NUM

LOG_GROUP.retentionInDays     #NUM (def: none) of days before deleting LLEVENTs, among:
                              #  - 1|3|5 days
                              #  - 1-2 weeks
                              #  - 1-6 months
                              #  - 1|1.5|2-10 years

LOG_GROUP.storedBytes         #Total NUM of bytes stored


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:            STREAM             :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


CreateLogStream()             #Req: LOG_STREAM
                              #  - only logStreamName, logGroupName
                              #Res: empty
DescribeLogStreams()          #Req: LOG_STREAM_REQ
                              #Res: LogStreams LOG_STREAM_ARR
                              #  - no logGroupName
DeleteLogStream()             #Req: LOG_STREAM
                              #  - only logStreamName, logGroupName
                              #Res: empty

LOG_STREAM                    #Series of LLEVENTs
                              #Deleted if empty for 2 months
LOG_STREAM.arn                #LOG_STREAM_ARN. arn:aws:logs:REGION:ACCOUNT_ID:log-group:LOG_GROUP:log-stream:LOG_STREAM
LOG_STREAM.logStreamName      #'LOG_STREAM'. Max 512 chars, no : or *
LOG_STREAM_REQ
 .logStreamNamePrefix         #STR
LOG_STREAM.creationTime       #DATE_NUM
LOG_STREAM.firstEventTimestamp#DATE_NUM of earliest LLEVENT
LOG_STREAM.lastIngestionTime  #DATE_NUM of latest LLEVENT starting processing
LOG_STREAM.lastEventTimestamp #DATE_NUM of latest LLEVENT finishing processing

LOG_STREAM[_REQ]
 |METRIC_FILTER.logGroupName  #'LOG_GROUP'
LOG_STREAM_REQ
 .logGroupIdentifier          #'LOG_GROUP'|LOG_GROUP_ARN

LOG_STREAM_REQ.orderBy        #'LogStreamName' (def) or 'LastEventTime'
LOG_STREAM_REQ.descending     #BOOL (def: false). Sorting order


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:            EVENTS             :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PutLogEvents()                #Req: LLEVENTS
                              #  - no LLEVENT.ingestionTime
                              #Res: LLEVENTS_NEW
GetLogEvents()                #Req: LLEVENTS_REQ
                              #  - no filterPattern, logStreamNamePrefix
                              #Res: events LLEVENT_ARR
FilterLogEvents()             #Req: LLEVENTS_REQ
                              #  - logStreamName STR -> logStreamNames STR_ARR + logStreamNamePrefix STR
                              #  - no startFromHead
                              #Res: events LLEVENT_ARR, searchedLogStreams LLEVENTS_RES_ARR

LLEVENTS.logEvents            #LLEVENT_ARR
                              #Max 1e4. Max 1MB
LLEVENT                       #Log message
                              #Max 256KB

LLEVENT.message               #STR

LLEVENT.ingestionTime         #DATE_NUM of LLEVENT itelf
LLEVENT.timestamp             #DATE_NUM of event being logged
                              #Max 14 days before ingestionTime, and 2h after it
                              #LLEVENTS.logEvents is sorted by LLEVENT.timestamp
                              #  - in request, must be sorted, with a max 24h span
LLEVENTS_REQ.startTime|endTime#DATE_NUM. Filter by LLEVENT.timestamp
LLEVENTS_REQ.startFromHead    #BOOL (def: true). asc|desc sorting order.
                              #Always sorted by LLEVENT.timestamp

LLEVENTS_NEW
 .rejectedLogEventsInfo       #LLEVENTS_REJECT. LLEVENTs that failed
LLEVENTS_REJECT
 .tooOldLogEventEndIndex      #NUM of LLEVENTs with a timestamp >14d older than ingestionTime
LLEVENTS_REJECT
 .tooNewLogEventStartIndex    #NUM of LLEVENTs with a timestamp >2h newer than ingestionTime
LLEVENTS_REJECT
 .expiredLogEventEndIndex     #NUM of LLEVENTs beyond LOG_GROUP.retentionInDays

LLEVENTS[_REQ|RES]
 .logStreamName               #'LOG_STREAM'
LLEVENTS_RES
 .searchedCompletely          #BOOL. Whether all LLEVENTs in LOG_STREAM were searched

LLEVENTS[_REQ].logGroupName   #'LOG_GROUP'
LLEVENTS_REQ
 .logGroupIdentifier          #'LOG_GROUP'|LOG_GROUP_ARN

LLEVENTS_REQ.filterPattern    #'FILTER_PATTERN'

LIVE TAIL ==>                 #View LLEVENTs as they come
                              #Can filter by LOG_GROUPs|LOG_STREAMs|FILTER_PATTERNs
                              #Can highlight specific words
                              #Requires PACTION logs:Start|StopLiveTail


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:        FILTER PATTERN         :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


FILTER_PATTERN                #Filter LLEVENTs by their message
                              #One of the following syntaxes
                              #Max 1KB

ANY MATCH ==>                 #
''                            #Matches anything

STRING MATCH ==>              #Does not create $FVARs
VAL                           #Can use wildcard *
                              #Case-sensitive
                              #Must "-quote non-[:alnum:]
VAL ...                       #Includes all of VALs
?VAL ...                      #Includes any of VALs
-VAL ...                      #Does not include VAL

JSON MATCH ==>                #Set each JSON field as $FVAR
{ $.VARR OP VAL }             #VARR: 1|many of VAR, ['VAR'] or [NUM]
                              #VAL: STR, "STR" or NUM
                              #  - can include wildcard *
{ $.VARR = != VAL }           #
{ $.VARR > >= < <= NUM }      #
{ $.VARR is null|true|false } #Same as = "true|true|false"
{ $.VARR not exists }         #Is undefined
{ ... || ... }
{ ... && ... }
{ (...) }                     #

WHITESPACE-DELIMITED MATCH ==>#For example, *.tsv
                              #Fields can []-quote or "-quote whitespaces
[FVAR, ...]                   #Set each field as $FVAR
[FVAR OP VAL, ...]            #VAL can use wildcard *
                              #OP: = != > >= < <=
                              #Default OP VAL: = * (always match)
[FVAR [OP VAL] || ..., ...]
[FVAR [OP VAL] && ..., ...]   #
[..., ...]                    #FVAR can be named ... in any position
                              #This sets each field as $NUM FVAR (1-based)
[wNUM [OP VAL], ...]          #FVAR can be named wNUM to match field at position NUM
                              #Last wNUM cannot use OP VAL
                              #  - can workaround this by adding a dummy wNUM at end
[]                            #Same as [...]


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:          METRIC MAIN          :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PutMetricFilter()             #Req: METRIC_FILTER
                              #  - no creationTime
                              #Res: empty
DescribeMetricFilters()       #Req: METRIC_FILTER|METRIC_TRANSFORM
                              #  - only logGroupName, metricName, metricNamespace
                              #  - only filterName -> filterNamePrefix STR
                              #Res: metricFilters METRIC_FILTER_ARR
DeleteMetricFilter()          #Req: METRIC_FILTER
                              #  - only filterName, logGroupName
                              #Res: empty

METRIC_FILTER                 #Create CloudWatch METRIC_DATA from LLEVENTs
                              #Max 100 per LOG_GROUP
METRIC_FILTER.filterName      #'METRIC_FILTER'
METRIC_FILTER.creationTime    #DATE_NUM

METRIC_FILTER.filterPattern   #'FILTER_PATTERN'

METRIC_FILTER
 .metricTransformations       #METRIC_TRANSFORM_ARR. METRIC_DATA being created
METRIC_TRANSFORM.metricName   #'METRIC'. METRIC.MetricName
METRIC_TRANSFORM
 .metricNamespace             #'NAMESPACE'. METRIC.Namespace
METRIC_TRANSFORM.dimensions   #OBJ. METRIC.Dimensions
                              #Max 3 DVARs
                              #If >1000 different DVALs in an hour, METRIC_FILTER automatically disabled
                              #DVAL include $FVAR
METRIC_TRANSFORM.metricValue  #STR. METRIC_DATUM.Value
                              #Can include $FVAR
METRIC_TRANSFORM.defaultValue #STR. METRIC_DATUM.Value
                              #Emitted when METRIC_FILTER.filterPattern does not match
                              #Goals:
                              #  - knowing frequency when filterPattern matches or not
                              #  - prevent undefined PERIODs, i.e. with no METRIC_DATA
METRIC_TRANSFORM.unit         #STR. METRIC_DATUM.Unit

LOG_GROUP.metricFilterCount   #NUM of METRIC_FILTERs


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:          METRIC TEST          :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


TestMetricFilter()            #Req: TEST_FILTER_REQ
                              #Res: matches TEST_FILTER_RES_ARR

TEST_FILTER_REQ               #Try a METRIC_FILTER against test LLEVENTs
TEST_FILTER_REQ               #STR_ARR of test LLEVENT.message
 .logEventMessages            #Max 50
TEST_FILTER_REQ.filterPattern #'FILTER_PATTERN'

TEST_FILTER_RES.eventMessage  #STR. Value in logEventMessages
TEST_FILTER_RES.eventNumber   #NUM. Index in logEventMessages
TEST_FILTER_RES
 .extractedValues             #{ $FVAR: STR, ... } matched by FILTER_PATTERN


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:          QUERY MAIN           :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


StartQuery()                  #Req: QUERY
                              #  - logGroupIdentifiers -> logGroupIdentifiers + logGroupName[s] STR[_ARR]
                              #  - no queryId, createTime, status
                              #Res: QUERY
                              #  - only queryId
                              #Paginates QUERY_RESULTS.results for GetQueryResults()
DescribeQueries()             #Req: QUERY
                              #  - only logGroupIdentifiers -> logGroupName STR
                              #  - only status
                              #Res: queries QUERY_ARR
                              #  - logGroupIdentifiers -> logGroupName STR
                              #  - no startTime|endTime
StopQuery()                   #Req: QUERY
                              #  - only queryId
                              #Res: QUERY
                              #  - only status -> success BOOL
GetQueryResults()             #Req: QUERY
                              #  - only queryId
                              #Res: QUERY_RESULTS

QUERY                         #Advanced search|query for LLEVENTs
                              #Called "Logs Insights"
                              #Max 30 running at once
QUERY.queryId                 #QUERY_MID
QUERY.createTime              #DATE_NUM

QUERY.queryString             #'QUERY_STRING'

QUERY.logGroupIdentifiers     #'LOG_GROUP'|LOG_GROUP_ARN_ARR
                              #Max 50

QUERY.startTime|endTime       #DATE_NUM, filtering by LLEVENT.timestamp

QUERY_RESULTS.results         #QUERY_RESULT_ARR_ARR
                              #Each QUERY_RESULT_ARR is a LLEVENT
                              #Each QUERY_RESULT is a field
QUERY_RESULT.field            #STR
QUERY_RESULT.value            #STR

QUERY[_RESULTS].status        #STR among:
                              #  - Scheduled
                              #  - Running
                              #  - Complete
                              #  - Failed, Cancelled
                              #  - Timeout: after 60m
                              #  - Unknown

QUERY_RESULTS.statistics      #QUERY_STATS
QUERY_STATS.recordsMatched    #NUM of LLEVENTs matched
QUERY_STATS.recordsScanned    #NUM of LLEVENTs read
QUERY_STATS.bytesScanned      #NUM of bytes read, from QUERY_STATS.recordsScanned


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:       QUERY DEFINITION        :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PutQueryDefinition()          #Req: QUERYDEF
                              #  - no lastModified
                              #Res: QUERYDEF
                              #  - only queryDefinitionId
DescribeQueryDefinitions()    #Req: QUERYDEF
                              #  - only name -> queryDefinitionNamePrefix STR
                              #Res: queryDefinitions QUERYDEF_ARR
DeleteQueryDefinition()       #Req: QUERYDEF
                              #  - only queryDefinitionId
                              #Res: success BOOL

QUERYDEF.queryDefinitionId    #QUERYDEF_MID
QUERYDEF.name                 #'QUERYDEF'
QUERYDEF.lastModified         #DATE_NUM

QUERYDEF.queryString          #'QUERY_STRING'

QUERYDEF.logGroupNames        #'LOG_GROUP'_ARR


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:         QUERY SYNTAX          :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


QUERY_STRING                  #
                              #Max 10KB

#COMMENT                      #
COMMAND | ...                 #Multiple COMMANDs

fields @FIELD,...

@message                      #LLEVENT.message
@ingestionTime                #LLEVENT.ingestionTime
@timestamp                    #LLEVENT.timestamp
@logStream                    #'LOG_STREAM'


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:         QUERY RECORD          :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


GetLogRecord()                #Req: QUERY_RECORD_REQ
                              #Res: QUERY_RECORD_RES

QUERY_RECORD_REQ
 .logRecordPointer            #STR

QUERY_RECORD_RES.logRecord    #OBJ


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:         QUERY FIELDS          :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


GetLogGroupFields()           #Req: QUERY_FIELDS_REQ
                              #Res: logGroupFields QUERY_FIELD_ARR

QUERY_FIELDS_REQ
 .logGroupIdentifier          #'LOG_GROUP'|LOG_GROUP_ARN
QUERY_FIELDS_REQ.logGroupName #'LOG_GROUP'

QUERY_FIELDS_REQ.time         #DATE_NUM

QUERY_FIELD.name              #STR
QUERY_FIELD.percent           #NUM


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:         SUBSCRIPTION          :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PutSubscriptionFilter()       #Req: SUBSCRIPTION
                              #  - no creationTime
                              #Res: empty
DescribeSubscriptionFilters() #Req: SUBSCRIPTION
                              #  - only filterName -> filterNamePrefix STR
                              #  - only logGroupName
                              #Res: subscriptionFilters SUBSCRIPTION_ARR
DeleteSubscriptionFilter()    #Req: SUBSCRIPTION
                              #  - only filterName, logGroupName
                              #Res: empty

SUBSCRIPTION.filterName       #'SUBSCRIPTION'
SUBSCRIPTION.creationTime     #DATE_NUM

SUBSCRIPTION.logGroupName     #'LOG_GROUP'

SUBSCRIPTION.destinationArn   #DESTINATION_ARN
SUBSCRIPTION.roleArn          #ROLE_ARN
                              #Requires PACTION iam:PassRole

SUBSCRIPTION.filterPattern    #'FILTER_PATTERN'
SUBSCRIPTION.distribution     #'Random' or 'ByLogStream'

https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/Subscriptions.html


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:          DESTINATION          :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PutDestination()              #Req: DESTINATION
                              #  - no arn, creationTime, accessPolicy, forceUpdate
                              #Res: destination DESTINATION
                              #  - no tags, forceUpdate
PutDestinationPolicy()        #Req: DESTINATION
                              #  - only destinationName, accessPolicy, forceUpdate
                              #Res: empty
DescribeDestinations()        #Req: DESTINATION
                              #  - only destinationName -> destinationNamePrefix STR
                              #Res: destinations DESTINATION_ARR
                              #  - no tags, forceUpdate
DeleteDestination()           #Req: DESTINATION
                              #  - only destinationName
                              #Res: empty

DESTINATION.arn               #DESTINATION_ARN. arn:aws:logs:REGION:ACCOUNT_ID:destination:DESTINATION
DESTINATION.destinationName   #'DESTINATION'
DESTINATION.creationTime      #DATE_NUM

DESTINATION.targetArn         #ARN

DESTINATION.accessPolicy      #IAM 'POLICY'
DESTINATION.forceUpdate       #BOOL

DESTINATION.roleArn           #ROLE_ARN
                              #Requires PACTION iam:PassRole, and trust policy for Principal.Service 'delivery.logs.amazonaws.com'
AWSServiceRoleForLogDelivery  #SERVICE_LINKED_ROLE used when DESTINATION.targetArn is Kinesis Data Firehose
                              #Automatically created, if PACTION iam:CreateServiceLinkedRole
AWSServiceRoleForLogDelivery  #AWS managed POLICY used by AWSServiceRoleForLogDelivery
 Policy                       #Allows PACTIONs firehose:PutRecord[Batch]|ListTagsForDeliveryStream
                              #  - providing Firehose delivery stream has TAG LogDeliveryEnabled 'true'
                              #     - automatically setup by AWS


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:            EXPORT             :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


CreateExportTask()            #Req: EXPORT
                              #  - no taskId, executionInfo, status
                              #Res: EXPORT
                              #  - only taskId
DescribeExportTasks()         #Req: EXPORT
                              #  - only taskId, statusCode
                              #Res: exportTasks EXPORT_ARR
                              #  - no logStreamNamePrefix
CancelExportTask()            #Req: EXPORT
                              #  - only taskId
                              #Res: empty

EXPORT.taskId                 #EXPORT_MID
EXPORT.taskName               #'EXPORT'
EXPORT.destination            #S3 'BUCKET'
EXPORT.destinationPrefix      #S3 'OBJECT' prefix
EXPORT
 .executionInfo.creationTime  #DATE_NUM

EXPORT.logGroupName           #'LOG_GROUP'
EXPORT.logStreamNamePrefix    #STR
EXPORT.from|to                #DATE_NUM

EXPORT.status.code            #STR among:
                              #  - PENDING
                              #  - RUNNING
                              #  - PENDING_CANCEL, CANCELLED
                              #  - COMPLETED, FAILED
EXPORT.status.message         #STR
EXPORT
 .executionInfo.completionTime#DATE_NUM

https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/S3Export.html


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:              KMS              :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


AssociateKmsKey()             #Req: KMS_ASSOC
                              #Res: empty
DisassociateKmsKey()          #Req: KMS_ASSOC
                              #  - no kmsKeyId
                              #Res: empty

KMS_ASSOC                     #Sets default KMS_KEY_ID for LOG_GROUP|QUERY_RES
KMS_ASSOC.kmsKeyId            #KMS_KEY_ID
KMS_ASSOC.logGroupName        #'LOG_GROUP'
KMS_ASSOC.resourceIdentifier  #Either:
                              #  - LOG_GROUP_ARN
                              #  - 'arn:aws:logs:REGION:ACCOUNT_ID:query-result:*'

LOG_GROUP.kmsKeyId            #KMS_KEY_ID. Encrypt LLEVENTs at rest
QUERY_RES.encryptionKey       #KMS_KEY_ID. Encrypt QUERY_RESULTs at rest

https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/encrypt-log-data-kms.html


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:        POLICY RESOURCE        :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PutResourcePolicy()           #Req: LOG_GROUP_POLICY
                              #  - no lastUpdatedTime
                              #Res: resourcePolicy LOG_GROUP_POLICY
DescribeResourcePolicies()    #Req: empty
                              #Res: resourcePolicies LOG_GROUP_POLICY_ARR
DeleteResourcePolicy()        #Req: LOG_GROUP_POLICY
                              #  - only policyName
                              #Res: empty

LOG_GROUP_POLICY.policyName   #'LOG_GROUP_POLICY'
LOG_GROUP_POLICY
 .lastUpdatedTime             #DATE_NUM

LOG_GROUP_POLICY
 .policyDocument              #IAM 'POLICY'

PACTION logs:Create|Update|Get|List|DeleteLogDelivery???


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:        POLICY ACCOUNT         :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PutAccountPolicy()            #Req: ACCOUNT_POLICY
                              #  - no lastUpdatedTime, accountId
                              #Res: accountPolicy ACCOUNT_POLICY
DescribeAccountPolicies()     #Req: ACCOUNT_POLICY
                              #  - only policyName, policyType
                              #  - only accountId -> accountIdentifiers ACCOUNT_ID_ARR
                              #Res: accountPolicies ACCOUNT_POLICY_ARR
DeleteAccountPolicy()         #Req: ACCOUNT_POLICY
                              #  - only policyName, policyType
                              #Res: empty

ACCOUNT_POLICY.policyName     #'ACCOUNT_POLICY'
ACCOUNT_POLICY.lastUpdatedTime#DATE_NUM

ACCOUNT_POLICY.policyDocument #IAM 'POLICY'
                              #Max 30KB

ACCOUNT_POLICY.accountId      #ACCOUNT_ID
ACCOUNT_POLICY.policyType     #Always 'DATA_PROTECTION_POLICY'
ACCOUNT_POLICY.scope          #Always 'ALL'

LOG_GROUP_REQ
 .includeLinkedAccounts       #BOOL (def: false)
LOG_GROUP_REQ                 #ACCOUNT_ID_ARR. Only if includeLinkedAccounts true
 .accountIdentifiers          #Max 20


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:    POLICY DATA PROTECTION     :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PutDataProtectionPolicy()     #Req: DATA_POLICY
                              #  - no lastUpdatedTime
                              #Res: DATA_POLICY
GetDataProtectionPolicy()     #Req: DATA_POLICY
                              #  - only logGroupIdentifier
                              #Res: DATA_POLICY
DeleteDataProtectionPolicy()  #Req: DATA_POLICY
                              #  - only logGroupIdentifier
                              #Res: empty

DATA_POLICY.logGroupIdentifier#'LOG_GROUP'|LOG_GROUP_ARN
DATA_POLICY.lastUpdatedTime   #DATE_NUM

DATA_POLICY.policyDocument    #IAM 'POLICY'

LOG_GROUP.dataProtectionStatus#STR among:
                              #  - ACTIVATED
                              #  - DISABLED
                              #  - DELETED, ARCHIVED
LOG_GROUP.inheritedProperties #Can only be 'ACCOUNT_DATA_PROTECTION'

LLEVENTS_REQ|QUERY_RECORD_REQ #BOOL. If false (def), sensitive data are masked
 .unmask                      #If true, requires PACTION logs:Unmask

https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/mask-sensitive-log-data.html


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:             TAGS              :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


ListTagsForResource()         #Req: RESOURCE_TAGS
                              #  - only resourceArn
                              #Res: RESOURCE_TAGS
                              #  - no resourceArn
TagResource()                 #Req: RESOURCE_TAGS
                              #Res: empty
UntagResource()               #Req: RESOURCE_TAGS
                              #  - tags -> tagKeys STR_ARR
                              #Res: empty

RESOURCE_TAGS                 #
RESOURCE_TAGS.resourceArn     #LOG_GROUP|DESTINATION_ARN
RESOURCE_TAGS.tags            #TAGS

LOG_GROUP|DESTINATION.tags    #TAGS
