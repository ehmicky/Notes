
             
   NODE_TEST  
             



VERSION ==>                       #Part of Node.js core

ASSERTIONS ==>                    #See Node.js assertion doc
                                  #Can also use any assertion library that throws
DIFF TESTING ==>                  #See Node.js snapshots doc
GENERIC MOCKING ==>               #See Node.js tests mocks doc


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:             TESTS             :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


test(['TITLE'][, OPTS], FUNC(T))  #Test fails when throwing
 ->PROMISE                        #FUNC can be async by using a PROMISE or callback FUNC(ERROR)
                                  #Def 'TITLE': FUNC.name or '<anonymous>'
                                  #PROMISE resolves once test has completed.
T.test(...)->PROMISE              #Sub-test.
                                  #Inherits all OPTS
                                  #PROMISE should be awaited

describe|it                       #Like [T.]test[.skip|...](...) except:
 [.skip|todo|only](...)           #  - sync
                                  #  - ST is passed as argument instead of T
[S]T.name                         #'TITLE'


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:         ORCHESTRATION         :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


[T.]before|after
 (FUNC()[->PROMISE]
 [, OPTS])                        #Run in beginning|end of file or of current describe|test()
[T.]before|afterEach
 (FUNC()[->PROMISE]
 [, OPTS])                        #Run in beginning|end of each test() of current describe|test()


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           SELECTION           :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


node FILE...                      #File selection
ROPTS.files 'FILE'_ARR            #Default: any files matching all of:
                                  #  - in cwd or descendant
                                  #  - not inside node_modules
                                  #  - extension is .js|cjs|mjs
                                  #  - either:
                                  #     - descendant of 'test' DIR
                                  #     - basename is test[-*], *.test, *_test or *-test

--test-name-pattern REGXP 18.11.0*#Only run tests with matching 'TITLE'

OPTS.skip                         #BOOL|'MESSAGE'
                                  #Skip the test
T.skip(['MESSAGE'])               #Same

OPTS.todo                         #BOOL|'MESSAGE'
                                  #Mark test as TODO
T.todo(['MESSAGE'])               #Same

OPTS.only                         #BOOL
                                  #Only run this test, providing node --test-only is used
T.runOnly(BOOL)                   #Same

                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           EXECUTION           :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


node --test               16.17.0*#Must be used

WATCH MODE ==>            18.11.0*#See core Node.js flag --watch*

run(ROPTS)->TAP_STREAM     18.9.0*#Run a test file programmatically
ROPTS.inspectPort          18.9.0*#NUM[()] or null (incremented from process.debugPort) (def: undefined)
TAP_STREAM                 18.9.0*#RSTREAM outputting TAP
TAP_STREAM.on
 ('test:diagnostic',
 FUNC('MESSAGE'))          18.9.0*#Called on T.diagnostic('MESSAGE')
TAP_STREAM.on              18.9.0*#Called on T.test()
 ('test:pass|fail',        18.9.0*#OBJ:
 FUNC(OBJ))                18.9.0*#  - name 'NAME'
                           18.9.0*#  - testNumber NUM
                           18.9.0*#  - skip STR|undefined
                           18.9.0*#  - todo STR|undefined
                           18.9.0*#  - duration NUM
                           18.9.0*#  (if fail)
                           18.9.0*#  - error ERROR
                           19.1.0*#  - expected
                           19.1.0*#  - actual
                           19.1.0*#  - operator

TEST RUN ==>                      #Test functions are run as they are defined (i.e. synchronously)
                                  #Top-level tests are performed serially, i.e. each test wait for previous one to end.

PROCESS EXIT ==>                  #On process exit (including SIGINT|SIGTERM):
                                  #  - make tests still running fail ("cancelled")
                                  #  - exit code 1 if one test failed
                                  #'uncaughtException|unhandledRejection' make top test fail

[S]T.signal                       #ABORT_SIGNAL
[R]OPTS.signal                    #ABORT_SIGNAL


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:           REPORTING           :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


TAP ==>                           #TAP is output on stdout, and exit code is 0|1 depending on success
                                  #See TAP documentation for details

T.diagnostic('MESSAGE')           #TAP comment. Only if test failed


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:             SPEED             :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


[R]OPTS.timeout                   #NUMms, per test


                                             /=+===============================+=\
                                            /  :                               :  \
                                            )==:          PARALLELISM          :==(
                                            \  :_______________________________:  /
                                             \=+===============================+=/


PARALLELISM ==>                   #Each file is executed in its own child process, in parallel

[R]OPTS.concurrency               #NUM (def: 1)
                                  #or BOOL (number of CPU cores - 1)
                                  #Run sub-tests in parallel, providing Promise.all() is used
