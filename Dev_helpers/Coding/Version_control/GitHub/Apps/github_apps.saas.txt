
               
   GITHUB_APPS  
               



GitHub API:
  - https://api.github.com: API root
  - Accept: application/vnd.github+json [C]
  - X-GitHub-Api-Version: YYYY-MM-DD [C]
     - current: 2022-11-28

OAuth apps:
  - deprecated older version of GitHub apps
  - could only "authorize", not "install"

Permissions:
  - specified on installation
  - are:
     - API actions
     - webhooks events
     - HTTP-based git access
        - including getting contents
        - separate permissions to get ./workflows
  - can choose repos
  - on repository, org, or account
  - can be installed by
     - a user
     - an org
        - only by org owner
        - or users with "GitHub app manager" role on specific app
           - can edit but not install|uninstall app
        - org user can request org owner
  - tokens are short-lived

Marketplace:
  - where it is installed
  - alternative:
     - GET https://github.com/apps/APP/installations/new
     - in UI, for local dev
     - private app
  - logo
  - can set a price

Can use GitHub API

Webhooks:
  - on events
  - webhook secret: to authenticate calls
  - prefer https

APP_ID
  - ID of app
  - can get with GET /app

CLIENT_ID
  - secret meant to generate UATs
  - can get from app settings UI

Authorization flow:
  - client secrets:
     - one per user, private
     - used to generate user access tokens
  - callback URL:
     - redirected to on installation
     - meant to generate user access tokens
     - can|should specify multiple ones
  - setup URL:
     - redirected on after installation
        - or on update
     - meant for docs
     - cannot be done together callback URL

Installation:
  - single installation of an app
  - INSTALLATION_ID:
     - available in:
        - webhook event payloads
        - GET /app/installations
        - GET /orgs/ORG/installation
        - GET /users/USER/installation
        - GET /repos/USER/REPO/installation

Authentication:
  - private key
     - of the app itself, not visible to users
     - PEM format (PKCS#1 RSAPrivateKey)
     - not stored by GitHub, i.e. only shown once
  - as the app
     - using a JWT
        - creation:
           - JWT ENVLOP:
              - alg 'RS256'
           - JWT PAYLOAD:
              - iat DATE_NUM
              - exp DATE_NUM: max iat + 10min
              - iss 'APP_ID'
           - JWT private key is app private key
        - passed to Authorization: Bearer JWT [C]
  - as the app installation
     - also called "server-to-server"
     - requires an app "install"
     - read|write access a repo|org
     - actions shown as done by app
     - use installation access token (IAT)
        - creation:
           - POST /app/installations/INSTALLATION_ID/access_tokens
           - authenticated "as the app"
        - passed to Authorization: Bearer JWT [C]
           - for HTTP-based git, use: https://x-access-token:JWT@github.com/USER/REPO.git
        - only valid 1 hour, no refresh, but can re-create
        - not restricted by user permissions
        - can be restricted to:
           - specific repositories
           - specific permissions
  - as the user
     - also called "user-to-server"
     - requires an app "authorize"
     - act on behalf of user, for other things than repo|org
        - i.e. some actions only available like this
     - shown as done by user, with additional hint it's been done through an app
     - use user access token (UAT)
        - uses OAuth
        - flows:
           - in the browser:
              - GET https://github.com/login/oauth/authorize
                 - ?client_id=CLIENT_ID
                 - ?redirect_uri=CALLBACK_URL
                 - ?state=OBJ
        - expiration:
           - expire every 8h
           - can refresh
           - refresh tokens expire every 6 months
        - users can revoke it
           - triggers 'github_app_authorization' webhook
           - should undo the app logic for that user
        - restricted by user permissions

Registering:
  - by user or org
  - name, description, homepage URL

Rate limiting

https://docs.github.com/en/rest/apps/apps?apiVersion=2022-11-28
