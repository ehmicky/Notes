
                                  ┏━━━━━━━━━┓
                                  ┃   IAM   ┃
                                  ┗━━━━━━━━━┛

VERSION ==>                       #2024-07-21

STS ==>                           #See STS doc for: ROLE, INSTANCE_PROFILE, SERVICE_LINKED_ROLE, SAML_PROVIDER, OPENID_PROVIDER
                                  #Part of STS: CALLER_IDENTITY, ACCESS_KEY_INFO, DECODED_AUTH_MESSAGE

SUMMARY ==>                       #Principal: root, user, group, anonymous
                                  #Long-term credentials: login profile, access key, signing certificate, service credential, SSH public key
                                  #Login profile: password policy, hardware|virtual MFA device
                                  #Policy: version, inline|managed, AWS managed, permission boundary
                                  #Policy document: resource|identity-based, allow|deny, PACTION, simulation, auth message decode
                                  #Condition operators: ARR, undefined, BOOL, STR, NUM, DATE, BUFFER, ARN, IP
                                  #Condition keys: variables, defaults, principal, resource, time, HTTP request
                                  #Reports: credentials, org|user accesses, summary
                                  #Account alias
                                  #Server certificate

                                  ┌─────────┐
                                  │   API   │
                                  └─────────┘

NAME ==>                          #Identity and Access Management

FORMAT ==>                        #Request: query parameter, with ?Action and ?Version
                                  #Response: XML

REQ_ID                            #RES.ResponseMetadata.RequestId

PAGINATION ==>                    #Req: Marker STR, MaxItems STR (def|max: 1e4)
                                  #Res: IsTruncated BOOL, Marker STR

PRICING ==>                       #Free

REGION ==>                        #Not REGION-specific

                                  ┌──────────┐
                                  │   AUTH   │
                                  └──────────┘

IAMFullAccess                     #AWS managed POLICY. Grants all IAM PACTIONs
IAMReadOnlyAccess                 #AWS managed POLICY. Grants all read-only IAM PACTIONs

                                  ┌────────────┐
                                  │   PULUMI   │
                                  └────────────┘

@pulumi/aws-iam                   #Pulumi PROV on top of @pulumi/aws[-native] for IAM, with higher-level KREZs
                                  #Not very useful, i.e. not documented.

                                  ┌────────────┐
                                  │   LIMITS   │
                                  └────────────┘

SUMMARY_MAP                       #IAM limits ("Quota") and usage.
                                  #Documented as OBJ, but actually an OBJ_ARR: key STR, value NUM

                                  ┌────────────────┐
                                  │   LIMITS API   │
                                  └────────────────┘

GetAccountSummary()               #Res: SUMMARY_MAP

                                  ┌──────────────┐
                                  │   IDENTITY   │
                                  └──────────────┘

IDENTITY                          #Who is authenticated.
                                  #Can be:
                                  #  - "Account": ROOT, or alternatively:
                                  #     - ACCOUNT_ID
                                  #     - CANONICAL_ACCOUNT_ID: only for cross-account S3 ACL
                                  #  - "User": USER
                                  #  - "FederatedUser": FEDERATED_USER
                                  #  - "AssumedRole": [ASSUMED_]ROLE, including through:
                                  #     - SERVICE_PRINCIPAL
                                  #     - SAML|OpenID
                                  #        - either as [ASSUMED_]ROLE, or as SAML_PROVIDER|'WEB_ID_DOMAIN'
                                  #  - "Anonymous"
                                  #     - only for S3, SNS, SQS
PRINCIPAL                         #IDENTITY performing a given request

ENTITY                            #Who is being permitted, from an authorization standpoint
                                  #E.g. includes GROUPs, unlike IDENTITY.

UROLE                             #USER|ROLE
UGROLE                            #USER|GROUP|ROLE
                                  #Should delete when not used anymore

                                  ┌─────────────────────┐
                                  │   CALLER IDENTITY   │
                                  └─────────────────────┘

CALLER_IDENTITY                   #Currently authenticated PRINCIPAL
CALLER_IDENTITY.Account           #ACCOUNT_ID
CALLER_IDENTITY.Arn               #ARN
CALLER_IDENTITY.UserId            #Like COND_KEY aws:userid

                                  ┌─────────────────────────┐
                                  │   CALLER IDENTITY API   │
                                  └─────────────────────────┘

GetCallerIdentity()               #Req: empty
                                  #Res: CALLER_IDENTITY

                                  ┌────────────────────────────┐
                                  │   CALLER IDENTITY PULUMI   │
                                  └────────────────────────────┘

CW.getCallerIdentity()            #To used instead
                                  #Not in IAM MODULE

                                  ┌──────────┐
                                  │   ROOT   │
                                  └──────────┘

ROOT                              #1 per AWS account

ROOT_ARN                          #'arn:aws:iam::ACCOUNT_ID:root'

PERMISSIONS ==>                   #Has full permissions
                                  #Also, only IDENTITY that can:
                                  #  - set|reset root credentials (password, ACCESS_KEY)
                                  #  - set ACCOUNT name or email, or close it

CREDENTIALS ==>                   #Use email address, not username
                                  #Can reset password through:
                                  #  - email
                                  #  - contact AWS support

MFA ==>                           #Can only be managed in UI
                                  #Required if management ACCOUNT of an ORG
                                  #If enabled, also requires phone number to reset password

POLICY ==>                        #Cannot have identity-based POLICY, PERM_BOUNDARY, session policy
                                  #But can be restricted by resource-based POLICY, ACL, ORG POLICY

STS ==>                           #Can use Get*Token() but not AssumeRole*()

ADMIN USER|GROUP ==>              #Recommended instead of using root
                                  #Can do everything or almost
                                  #Can use AdministratorAccess|PowerUserAccess AWS managed ROLE

                                  ┌─────────────┐
                                  │   ROOT UI   │
                                  └─────────────┘

https://console.aws.amazon.com    #Sign-in URL for root
                                  #Does not use LOGIN_PROFILE

                                  ┌──────────┐
                                  │   USER   │
                                  └──────────┘

USER                              #Real person.
                                  #Prefer using ROLEs when possible, because their credentials is short-lived
                                  #  - e.g. by using an identity provider like AWS Identity Center
                                  #Max 5000 (SUMMARY_MAP.Users[Quota])
                                  #WAIT (GetUser()) UserExists: when it exists
USER.Arn                          #USER_ARN. 'arn:aws:iam::ACCOUNT_ID:user[/PATH]/NAME'
USER.UserId                       #USER_MID
USER.UserName                     #'USER'
USER.Path                         #NAMEPATH
USER.CreateDate                   #'DATE'
USER.PasswordLastUsed             #'DATE' of last LOGIN_PROFILE sign-in
                                  #null if never signed in
                                  #Time is 5-min throttled

USER.Tags                         #RESOURCE_NAME: UserName 'USER'

DEACTIVATE ==>                    #To deactivate USER without deleting it: attach POLICY denying all PACTIONs

                                  ┌──────────────┐
                                  │   USER API   │
                                  └──────────────┘

CreateUser()                      #Req: USER
                                  #  - no Arn, UserId, CreateDate, PasswordLastUsed
                                  #Res: User USER
UpdateUser()                      #Req: USER
                                  #  - no Arn, UserId, CreateDate, PasswordLastUsed, PermissionsBoundary, Tags
                                  #  - UserName -> UserName + NewUserName
                                  #  - Path -> NewPath
                                  #Res: empty
GetUser()                         #Req: USER
                                  #  - only UserName
                                  #Res: User USER
ListUsers()                       #Req: USER
                                  #  - only Path -> PathPrefix
                                  #Res: Users USER_ARR
DeleteUser()                      #Req: USER
                                  #  - only UserName
                                  #Res: empty

TagUser()
ListUserTags()
UntagUser()                       #AWS TAGS

                                  ┌──────────────┐
                                  │   USER IAC   │
                                  └──────────────┘

AWS::IAM::User                    #RESPROPs: UserName, Path, Tags
                                  #RESATTRs: Arn

new User(...CARGS[, OPTS])        #CUSER. CKRESOURCE wrapping USER
                                  #Is YGRANTABLE. Is ICPRINCIPAL
User.fromUserArn
 (...CARGS, 'USER_ARN')->ICUSER   #
User.fromUserName
 (...CARGS, 'USER')->ICUSER       #
ICUSER.userArn
OPTS|ICUSER.userName
OPTS.path                         #USER.*

                                  ┌─────────────────┐
                                  │   USER PULUMI   │
                                  └─────────────────┘

USER_RPROPS.forceDestroy          #BOOL. If false (def), delete|replace fails unless USER has either:
                                  #  - ACCESS_KEY|LOGIN_PROFILE|MFA_DEVICE not managed by PROV
                                  #  - a POLICY through PolicyAttachment (not UserPolicy[Attachment])

                                  ┌───────────┐
                                  │   GROUP   │
                                  └───────────┘

GROUP                             #Sets of USERs
                                  #Allow managing permissions of multiple USERs.
                                  #Not meant for authentication.
                                  #USER can belong to 0, 1 or several GROUPs.
                                  #Should prefer attaching POLICYs to GROUPs than USERs, when possible
                                  #Max 300 (flexible to 500) (SUMMARY_MAP.Groups[Quota])
                                  #Max 10 per user (SUMMARY_MAP.GroupsPerUserQuota)
GROUP.Arn                         #GROUP_ARN. 'arn:aws:iam::ACCOUNT_ID:group[/PATH]/NAME'
GROUP.GroupId                     #GROUP_MID
GROUP.GroupName                   #'GROUP'
GROUP.Path                        #NAMEPATH
GROUP.CreateDate                  #'DATE'

FGROUP                            #GROUP, including the list of USERs
FGROUP.Users                      #USER_ARR
FGROUP.Group                      #GROUP

GROUP_USER                        #One USER in a GROUP
GROUP_USER.UserName               #'USER'
GROUP_USER.GroupName              #'GROUP'

                                  ┌───────────────┐
                                  │   GROUP API   │
                                  └───────────────┘

CreateGroup()                     #Req: GROUP
                                  #  - no Arn, GroupId, CreateDate
                                  #Res: FGROUP
                                  #  - no Users
UpdateGroup()                     #Req:
                                  #  - no Arn, GroupId, CreateDate
                                  #  - GroupName -> GroupName + NewGroupName
                                  #  - Path -> NewPath
                                  #Res: empty
AddUserToGroup()                  #Req: GROUP_USER
                                  #Res: empty
RemoveUserFromGroup()             #Req: GROUP_USER
                                  #Res: empty
GetGroup()                        #Req: GROUP
                                  #  - only GroupName
                                  #Res: FGROUP
ListGroups()                      #Req: GROUP
                                  #  - only Path -> PathPrefix
                                  #Res: Groups GROUP_ARR
ListGroupsForUser()               #Req: FGROUP
                                  #  - only UserName
                                  #Res: Groups GROUP_ARR
DeleteGroup()                     #Req: GROUP
                                  #  - only GroupName
                                  #Res: empty

                                  ┌───────────────┐
                                  │   GROUP IAC   │
                                  └───────────────┘

AWS::IAM::Group                   #RESPROPs: GroupName, Path
                                  #RESATTRs: Arn
AWS::IAM::UserToGroupAddition     #RESPROPs: GroupName, Users 'USER'_ARR

new Group(...CARGS[, OPTS])       #CGROUP. CKRESOURCE wrapping GROUP
                                  #Is YGRANTABLE. Is ICPRINCIPAL
Group.fromGroupArn
 (...CARGS, GROUP_ARN)->ICGROUP   #
Group.fromGroupName
 (...CARGS, 'GROUP')->ICGROUP     #
OPTS|ICGROUP.groupArn
OPTS|ICGROUP.groupName
OPTS.path                         #GROUP.*
CUSER_OPTS.groups                 #ICGROUP_ARR (def: [])
ICUSER.addToGroup(ICGROUP)        #
ICGROUP.addUser(ICUSER)           #

                                  ┌──────────────────┐
                                  │   GROUP PULUMI   │
                                  └──────────────────┘

FGROUP                            #Either:
                                  #  - 1 GroupMembership per GROUP (GROUP + USER_ARR)
                                  #  - 1 UserGroupMembership per USER (GROUP_ARR + USER)

                                  ┌────────────────┐
                                  │   GROUP LINT   │
                                  └────────────────┘

cdk-nag IAMUserNoPolicies         #USERs (as opposed to GROUPs) have no IPOLICY|MPOLICY
cdk-nag IAMGroupHasUsers          #GROUP has >= 1 USER (using either FGROUP or GROUP_USER)
cdk-nag IAMUserGroupMembership    #Each USER has >= 1 GROUP (using either FGROUP or GROUP_USER)

                                  ┌─────────────────┐
                                  │   CREDENTIALS   │
                                  └─────────────────┘

CREDS                             #See AWS auth doc

CREDS_REQ.Description             #STR
CREDS_REQ.State                   #'STARTED', 'INPROGRESS' or 'COMPLETE'

CREDS_REPORT                      #All long-term CREDS of current ACCOUNT
                                  #Throttled once per 4h
CREDS_REPORT.GeneratedTime        #'DATE'
CREDS_REPORT.ReportFormat         #'text/csv'
CREDS_REPORT.Content              #'CSV_BASE64' of CREDS_CONTENT_ARR
CREDS_CONTENT                     #CREDS of a USER
CREDS_CONTENT.user                #'USER'
CREDS_CONTENT.arn                 #USER_ARN
CREDS_CONTENT.user_creation_time  #'DATE'

                                  ┌─────────────────────┐
                                  │   CREDENTIALS API   │
                                  └─────────────────────┘

GenerateCredentialReport()        #Req: empty
                                  #Res: CREDS_REQ
GetCredentialReport()             #Req: empty
                                  #Res: CREDS_REPORT

                                  ┌────────────────┐
                                  │   BUILDER ID   │
                                  └────────────────┘

AWS BUILDER ID ==>                #Long-term credentials tied to real user, not to an AWS account
                                  #Can be used to login to AWS at https://profile.aws.amazon.com
                                  #Can also be used to login to other AWS related services:
                                  #AWS re:Post, CodeCatalyst, CodeWhisperer
                                  #Can use MFA

                                  ┌───────────────────┐
                                  │   LOGIN PROFILE   │
                                  └───────────────────┘

LOGIN_PROFILE                     #Password of a user to login to web console UI
                                  #Under-the-hood, generate short-term CREDS (see auth doc)
                                  #Max 1 per user
LOGIN_PROFILE.UserName            #'USER'
LOGIN_PROFILE.CreateDate          #'DATE'
LOGIN_PROFILE.Password            #STR
                                  #ASCII only
LOGIN_PROFILE
 .PasswordResetRequired           #BOOL (def: false). Set to true to require resetting password.

PASSWORD                          #LOGIN_PROFILE or root password

CREDS_CONTENT.password_enabled    #'TRUE|FALSE'. Whether there is a LOGIN_PROFILE.
                                  #'not_supported' if root.
CREDS_CONTENT.password_last_used  #'DATE' of last PASSWORD login
                                  #Can be 'no_information' (never used) or 'N/A' (no PASSWORD)
CREDS_CONTENT                     #'DATE' of last LOGIN_PROFILE.Password change
 .password_last_changed           #Can be 'not_supported' (root) or 'N/A' (not done)

                                  ┌──────────────────────┐
                                  │   LOGIN PROFILE UI   │
                                  └──────────────────────┘

https://
 ACCOUNT_ID.signin.aws.amazon.com #Sign-in URL for USER
 /console[?region=REGION]         #Version: 2023-03-03

SIGN-IN LOGGING ==>               #On CloudTrail: SERVICE_DOMAIN 'signin.amazonaws.com', ACTION 'ConsoleLogin'
                                  #RESP.ConsoleLogin 'Success|Failure'
CLOUDTRAIL_METADATA LoginTo       #'URL'
CLOUDTRAIL_METADATA.MobileVersion #'Yes|No'

                                  ┌────────────────────────┐
                                  │   LOGIN PROFILE AUTH   │
                                  └────────────────────────┘

IAMUserChangePassword             #AWS managed POLICY. Grants ChangePassword + GetAccountPasswordPolicy
                                  #  - so users can see password policy when changing it, especially in UI

                                  ┌───────────────────────┐
                                  │   LOGIN PROFILE API   │
                                  └───────────────────────┘

CreateLoginProfile()              #Req: LOGIN_PROFILE
                                  #  - no CreateDate
                                  #Res: LoginProfile LOGIN_PROFILE
                                  #  - no Password
UpdateLoginProfile()              #Req: LOGIN_PROFILE
                                  #  - no CreateDate
                                  #Res: empty
ChangePassword()                  #Req: LOGIN_PROFILE
                                  #  - only Password -> OldPassword + NewPassword
                                  #Res: empty
GetLoginProfile()                 #Req: LOGIN_PROFILE
                                  #  - only UserName
                                  #Res: LoginProfile LOGIN_PROFILE
                                  #  - no Password
DeleteLoginProfile()              #Req: LOGIN_PROFILE
                                  #  - only UserName
                                  #Res: empty

                                  ┌───────────────────────┐
                                  │   LOGIN PROFILE IAC   │
                                  └───────────────────────┘

AWS::IAM::User                    #Includes RESPROPs: LoginProfile OBJ: Password, PasswordResetRequired

CUSER_OPTS.password               #CSECRET. LOGIN_PROFILE.Password
CUSER_OPTS.passwordResetRequired  #LOGIN_PROFILE.*

                                  ┌──────────────────────────┐
                                  │   LOGIN PROFILE PULUMI   │
                                  └──────────────────────────┘

LOGIN_PROFILE_RPROPS              #NUM (def: 20). Used for LOGIN_PROFILE.Password
 .PasswordLength                  #I.e. let Pulumi generate
OUTPUTS.password                  #STR. Plain
OUTPUTS.encryptedPassword         #STR. Encrypted, base64

USER_RPROPS.pgpKey                #STR. Like LOGIN_PROFILE, but using OUTPUTS.encryptedPassword

                                  ┌─────────────────────┐
                                  │   PASSWORD POLICY   │
                                  └─────────────────────┘

PASSWORD_POLICY                   #Constraints on all LOGIN_PROFILE.Password

PASSWORD_POLICY
 .AllowUsersToChangePassword      #BOOL (def: false)

PASSWORD_POLICY.MaxPasswordAge    #NUM. Require resetting password after NUM days.
                                  #Warning in UI when 2 weeks before expiration
                                  #Max 3 years
PASSWORD_POLICY.ExpirePasswords   #BOOL. True when MaxPasswordAge defined
PASSWORD_POLICY.HardExpiry        #BOOL (def: false). When true, expired password can only be updated by root, not user.
CREDS_CONTENT                     #'DATE' of next rotation with PASSWORD_POLICY.MaxPasswordAge
 .password_next_rotation          #Can be 'not_supported' (root)

PASSWORD_POLICY
 .PasswordReusePrevention         #NUM. If set, remembers last NUM passwords and do not allow re-using them.

PASSWORD_POLICY
 .MinimumPasswordLength           #NUM (def: 8)
PASSWORD_POLICY.Require*          #Default:
                                  #  - false for each
                                  #  - but 3 out of 4 must be true
PASSWORD_POLICY
 .RequireLowercaseCharacters      #BOOL
PASSWORD_POLICY
 .RequireUppercaseCharacters      #BOOL
PASSWORD_POLICY.RequireNumbers    #BOOL
PASSWORD_POLICY.RequireSymbols    #BOOL

                                  ┌─────────────────────────┐
                                  │   PASSWORD POLICY API   │
                                  └─────────────────────────┘

UpdateAccountPasswordPolicy()     #Req: PASSWORD_POLICY
                                  #  - no ExpirePasswords
                                  #Res: empty
                                  #Does not apply to existing passwords, except MaxPasswordAge
GetAccountPasswordPolicy()        #Req: empty
                                  #Res: PasswordPolicy PASSWORD_POLICY
DeleteAccountPasswordPolicy()     #Req: empty
                                  #Res: empty

                                  ┌─────────────────────────┐
                                  │   PASSWORD POLICY IAC   │
                                  └─────────────────────────┘

AwsCommunity::IAM::PasswordPolicy #For PASSWORD_POLICY

                                  ┌─────────┐
                                  │   MFA   │
                                  └─────────┘

MFA_DEVICE                        #MFA hardware device to use with LOGIN_PROFILE
                                  #Max 8 per user
MFA_DEVICE.SerialNumber           #MFA_DEVICE_MID
MFA_DEVICE.UserName               #'USER'
MFA_DEVICE.EnableDate             #'DATE'
MFA_DEVICE.AuthenticationCode1    #STR. First code from MFA device on creation.
MFA_DEVICE.AuthenticationCode2    #STR. Second code from MFA device on creation, i.e. must enter 2 back-to-back

FIDO_KEY                          #MFA_DEVICE with stronger protection
                                  #Specific to a given client device, i.e. login with client device (usually smartphone)
                                  #Public key is known by AWS, private key is kept on client device
                                  #Either:
                                  #  - "security key": physical device
                                  #  - "synced passkey": credential manager (Google|Apple|Microsoft account, 1password, Bitwarden, etc.)
                                  #Cannot be used with STS
                                  #Can only be managed in the UI

                                  ┌─────────────┐
                                  │   MFA API   │
                                  └─────────────┘

EnableMFADevice()                 #Req: MFA_DEVICE
                                  #  - no EnableDate
                                  #Res: empty
ResyncMFADevice()                 #Req: MFA_DEVICE
                                  #  - no EnableDate
                                  #Res: empty
                                  #Re-enable MFA_DEVICE.
                                  #Needed for example when took too much time to enter MFA_DEVICE.AuthenticationCode1|2
                                  #Not needed with FIDO_KEY
GetMFADevice()                    #Req: MFA_DEVICE
                                  #  - only UserName, SerialNumber
                                  #Res: MFA_DEVICE
                                  #  - no AutenticationCode1|2
ListMFADevices()                  #Req: MFA_DEVICE
                                  #  - only UserName
                                  #Res: MFADevices MFA_DEVICE_ARR
                                  #  - no AutenticationCode1|2
DeactivateMFADevice()             #Req: MFA_DEVICE
                                  #  - only SerialNumber, UserName
                                  #Res: empty

                                  ┌─────────────────┐
                                  │   VIRTUAL MFA   │
                                  └─────────────────┘

VIRTUAL_MFA_DEVICE                #MFA mobile app to use with LOGIN_PROFILE
                                  #Max 1 per user (SUMMARY_MAP.AccountMFAEnabled|MFADevices[InUse])
VIRTUAL_MFA_DEVICE.SerialNumber   #VIRTUAL_MFA_DEVICE_ARN. 'arn:aws:iam::ACCOUNT_ID:mfa[/PATH]/NAME'
VIRTUAL_MFA_DEVICE
 .VirtualMFADeviceName            #'VIRTUAL_MFA_DEVICE'
VIRTUAL_MFA_DEVICE.Path           #NAMEPATH
VIRTUAL_MFA_DEVICE.User           #USER
VIRTUAL_MFA_DEVICE.EnableDate     #'DATE'
VIRTUAL_MFA_DEVICE
 .Base32StringSeed                #Base32-encoded STR. Secret key used for creation
VIRTUAL_MFA_DEVICE.QRCodePNG      #'PNG_BASE64' of the creation QR code
                                  #QR code content is 'otpauth://totp/VIRTUAL_MFA_DEVICE@ACCOUNT_ID|USER?secret=BASE_32_STRING_SEED'

VIRTUAL_MFA_DEVICE.Tags           #RESOURCE_NAME: SerialNumber VIRTUAL_MFA_DEVICE_ARN

CREDS_CONTENT.mfa_active          #'TRUE|FALSE'. Whether there is a MFA_DEVICE

MFA SIGN-IN LOGGING ==>           #On CloudTrail: ACTION 'ConsoleLogin'
CLOUDTRAIL_METADATA MFAIdentifier #[VIRTUAL_]MFA_DEVICE_ARN
CLOUDTRAIL_METADATA MFAUsed       #'Yes|No'

MFA LOGGING CHECK ==>             #On CloudTrail: SERVICE_DOMAIN 'signin.amazonaws.com', ACTION 'CheckMfa'
                                  #RESP.CheckMfa 'Success|Failure'
CLOUDTRAIL_METADATA MFAType       #'Virtual MFA' or 'Multiple MFA Devices'

                                  ┌─────────────────────┐
                                  │   VIRTUAL MFA API   │
                                  └─────────────────────┘

CreateVirtualMFADevice()          #Req: VIRTUAL_MFA_DEVICE
                                  #  - only VirtualMFADeviceName, Path, Tags
                                  #Res: VirtualMFADevice VIRTUAL_MFA_DEVICE
                                  #  - no VirtualMFADeviceName, Path
ListVirtualMFADevices()           #Req:
                                  #  - AssignmentStatus 'Assigned', 'Unassigned' or 'Any' (def)
                                  #Res: VirtualMFADevices VIRTUAL_MFA_ARR
                                  #  - no VirtualMFADeviceName, Path
DeleteVirtualMFADevice()          #Req: VIRTUAL_MFA_DEVICE
                                  #  - only SerialNumber
                                  #Res: empty

TagMFADevice()
ListMFADeviceTags()
UntagMFADevice()                  #AWS TAGS

                                  ┌─────────────────────┐
                                  │   VIRTUAL MFA IAC   │
                                  └─────────────────────┘

AWS::IAM::VirtualMFADevice        #RESPROPs:
                                  #  - VirtualMfaDeviceName, Path, Tags
                                  #  - Users 'USER'_ARR
                                  #RESATTRs: SerialNumber

                                  ┌────────────────────────┐
                                  │   VIRTUAL MFA PULUMI   │
                                  └────────────────────────┘

iamMfaEnabledForConsoleAccess     #Pulumi POLICY that checks that every USER has 1 [VIRTUAL_]MFA_DEVICE

                                  ┌────────────────┐
                                  │   ACCESS KEY   │
                                  └────────────────┘

ACCESS_KEY                        #Programmatic long-term CREDS (see AWS auth doc)
                                  #Should be rotated:
                                  #  - keep old one while updating consumers to use new one
                                  #  - wait a few days and check for LastUsedDate to ensure not used anymore
                                  #  - put as Status 'Inactive' for a few days before deleting
                                  #Max 2 per USER|root (SUMMARY_MAP.AccountAccessKeysPresent|AccessKeysPerUserQuota), for rotation
ACCESS_KEY.AccessKeyId            #CREDS.AccessKeyId (see AWS auth doc)
ACCESS_KEY.SecretAccessKey        #CREDS.SecretAccessKey (see AWS auth doc)
ACCESS_KEY.UserName               #'USER' (def: current one)
ACCESS_KEY.Status                 #'Active' (def) or 'Inactive' (manually disabled)

ACCESS_KEY.CreateDate             #'DATE'
ACCESS_KEY.AccessKeyLastUsed      #ACCESS_KEY_LAST_USED
ACCESS_KEY_LAST_USED.LastUsedDate #'DATE'. null if not used in last 400 days
                                  #15 minutes-throttled
ACCESS_KEY_LAST_USED.Region       #'REGION'. Not defined if not REGION-specific (e.g. S3)
ACCESS_KEY_LAST_USED.ServiceName  #'SERVICE'

CREDS_CONTENT.access_key_1|2_*    #
CREDS_CONTENT.access_key_*_active #'TRUE|FALSE'. Whether there is an ACCESS_KEY
CREDS_CONTENT                     #'DATE' of last update.
 .access_key_*_last_rotated       #Can be 'N/A' (no ACCESS_KEY)
CREDS_CONTENT                     #'DATE'. ACCESS_KEY.AccessKeyLastUsed.LastUsedDate
 .access_key_*_last_used_date     #Can be 'N/A' (no ACCESS_KEY, or never used)
CREDS_CONTENT                     #'DATE'. ACCESS_KEY.AccessKeyLastUsed.Region
 .access_key_*_last_used_region   #Can be 'N/A' (no ACCESS_KEY, or never used)
CREDS_CONTENT                     #'SERVICE'. ACCESS_KEY.AccessKeyLastUsed.ServiceName
 .access_key_*_last_used_service  #Can be 'N/A' (no ACCESS_KEY, or never used)

ACCESS_KEY_REQ                    #
ACCESS_KEY_REQ.AccessKeyId        #ACCESS_KEY_ID

ACCESS_KEY_INFO                   #
ACCESS_KEY_INFO.Account           #ACCOUNT_ID

                                  ┌────────────────────┐
                                  │   ACCESS KEY API   │
                                  └────────────────────┘

CreateAccessKey()                 #Req: ACCESS_KEY
                                  #  - only UserName
                                  #Res: AccessKey ACCESS_KEY
                                  #  - no AccessKeyLastUsed
UpdateAccessKey()                 #Req: ACCESS_KEY
                                  #  - no CreateDate, SecretAccessKey, AccessKeyLastUsed
                                  #Res: empty
GetAccessKeyLastUsed()            #Req: ACCESS_KEY
                                  #  - only AccessKeyId
                                  #Res: ACCESS_KEY
                                  #  - only UserName, AccessKeyLastUsed
ListAccessKeys()                  #Req: ACCESS_KEY
                                  #  - only UserName
                                  #Res: AccessKeyMetadata ACCESS_KEY_ARR
                                  #  - no SecretAccessKey, AccessKeyLastUsed
DeleteAccessKey()                 #Req: ACCESS_KEY
                                  #  - only AccessKeyId, UserName
                                  #Res: empty

GetAccessKeyInfo()                #Req: ACCESS_KEY_REQ
                                  #Res: ACCESS_KEY_INFO

                                  ┌────────────────────┐
                                  │   ACCESS KEY IAC   │
                                  └────────────────────┘

AWS::IAM::AccessKey               #RESPROPs:
                                  #  - UserName, Status
                                  #  - Serial: arbitrary NUM. Can be changed to force rotating the key
                                  #RESATTRs: SecretAccessKey

new AccessKey(...CARGS, OPTS)     #CACCESS_KEY. CKRESOURCE wrapping ACCESS_KEY
OPTS.user                         #CUSER. ACCESS_KEY.UserName
OPTS.status                       #ACCESS_KEY.*
OPTS.serial                       #See AWS::IAM::AccessKey
CACCESS_KEY.accessKeyId           #ACCESS_KEY_ID, as STR_TK resolving to { Ref }
CACCESS_KEY.secretAccessKey       #SECRET_ACCESS_KEY, as CSECRET resolving to { Fn::GetAtt }

                                  ┌───────────────────────┐
                                  │   ACCESS KEY PULUMI   │
                                  └───────────────────────┘

OUTPUTS.secret                    #Used instead of ACCESS_KEY.SecretAccessKey
USER_RPROPS.pgpKey                #STR. Public GPG key, or 'keybase:USER'
                                  #Additional PGP encryption when accessing through Pulumi, not on AWS resource itself
                                  #No OUTPUTS.secret
                                  #OUTPUTS.encryptedSecret:
                                  #  - ACCESS_KEY.SecretAccessKey + additional PGP encryption
                                  #  - user must decrypt with their key to get ACCESS_KEY.SecretAccessKey
                                  #Also returns OUTPUTS.keyFingerprint STR

iamAccessKeysRotated              #Pulumi POLICY that checks that every ACCESS_KEY is rotated,
                                  #i.e.CreateDate is at most PPCONF.maxKeyAge days old (def: 90).

                                  ┌─────────────────────────┐
                                  │   SIGNING CERTIFICATE   │
                                  └─────────────────────────┘

SIGNING_CERTIFICATE               #X.509 client certificate for a USER to authenticate with some SERVICEs (parts of EC2)
                                  #Max 2 per user (SUMMARY_MAP.AccountSigningCertificatesPresent|SigningCertificatesPerUserQuota)
SIGNING_CERTIFICATE.CertificateId #'SIGNING_CERTIFICATE'
SIGNING_CERTIFICATE.UploadDate    #'DATE'
SIGNING_CERTIFICATE.UserName      #'USER'
SIGNING_CERTIFICATE
 .CertificateBody                 #'PEM'. X.509 public key certficate
SIGNING_CERTIFICATE.Status        #'Active' (def) or 'Inactive'

CREDS_CONTENT.cert_1|2_*          #
CREDS_CONTENT.cert_*_active       #'TRUE|FALSE'. Whether there is a SIGNING_CERTIFICATE
CREDS_CONTENT.cert_*_last_rotated #'DATE' of last update.

                                  ┌─────────────────────────────┐
                                  │   SIGNING CERTIFICATE API   │
                                  └─────────────────────────────┘

UploadSigningCertificate()        #Req: SIGNING_CERTIFICATE
                                  #  - no CertificateId, UploadDate, Status
                                  #Res: Certificate SIGNING_CERTIFICATE
UpdateSigningCertificate()        #Req: SIGNING_CERTIFICATE
                                  #  - no UploadDate, CertificateBody
                                  #Res: empty
ListSigningCertificates()         #Req: SIGNING_CERTIFICATE
                                  #  - only UserName
                                  #Res: Certificates SIGNING_CERTIFICATE_ARR
DeleteSigningCertificate()        #Req: SIGNING_CERTIFICATE
                                  #  - only CertificateId, UserName
                                  #Res: empty

                                  ┌────────────────────────┐
                                  │   SERVICE CREDENTIAL   │
                                  └────────────────────────┘

SERVICE_CREDS                     #Like LOGIN_PROFILE, but username|password is AWS-generated
                                  #Only for CodeCommit and AWS Keyspaces
SERVICE_CREDS
 .ServiceSpecificCredentialId     #SERVICE_CREDS_MID
SERVICE_CREDS.CreateDate          #'DATE'
SERVICE_CREDS.ServiceName         #'SERVICE'
SERVICE_CREDS.UserName            #'USER'
SERVICE_CREDS.ServiceUserName     #STR. Credential's username
SERVICE_CREDS.ServicePassword     #STR
SERVICE_CREDS.Status              #'Active' (def) or 'Inactive'

                                  ┌─────────────────────────────┐
                                  │   SERVICE CREDENTIAL AUTH   │
                                  └─────────────────────────────┘

IAMSelfManage
 ServiceSpecificCredentials       #AWS managed POLICY. Grants all SERVICE_CREDS PACTIONs

                                  ┌────────────────────────────┐
                                  │   SERVICE CREDENTIAL API   │
                                  └────────────────────────────┘

CreateServiceSpecificCredential() #Req: SERVICE_CREDS
                                  #  - no ServiceSpecificCredentialId, CreateDate, ServiceUserName, Status
                                  #Res: ServiceSpecificCredential SERVICE_CREDS
ResetServiceSpecificCredential()  #Reset the password
                                  #Req: SERVICE_CREDS
                                  #  - only ServiceSpecificCredentialId, UserName
                                  #Res: ServiceSpecificCredential SERVICE_CREDS
UpdateServiceSpecificCredential() #Req: SERVICE_CREDS
                                  #  - no CreateDate, ServiceName, ServiceUserName, ServicePassword
                                  #Res: empty
ListServiceSpecificCredentials()  #Req: SERVICE_CREDS
                                  #  - only ServiceName, UserName
                                  #Res: ServiceSpecificCredentials SERVICE_CREDS_ARR
                                  #  - no ServicePassword
DeleteServiceSpecificCredential() #Req: SERVICE_CREDS
                                  #  - only ServiceSpecificCredentialId, UserName
                                  #Res: empty

                                  ┌────────────────────┐
                                  │   SSH PUBLIC KEY   │
                                  └────────────────────┘

SSH_PUBLIC_KEY                    #SSH public key to authenticate a USER. Only for CodeCommit.
                                  #Max 5 per USER
SSH_PUBLIC_KEY.SSHPublicKeyId     #SSH_PUBLIC_KEY_MID
SSH_PUBLIC_KEY.UserName           #'USER'
SSH_PUBLIC_KEY.UploadDate         #'DATE'
SSH_PUBLIC_KEY.Status             #'Active' (def) or 'Inactive'
SSH_PUBLIC_KEY.SSHPublicKeyBody   #STR. Content of public key
SSH_PUBLIC_KEY.Encoding           #'SSH' (ssh-rsa format) or 'PEM'. Format of SSH_PUBLIC_KEY.SSHPublicKeyBody
                                  #Def: either
SSH_PUBLIC_KEY.Fingerprint        #STR. MD5 hash of public key

                                  ┌─────────────────────────┐
                                  │   SSH PUBLIC KEY AUTH   │
                                  └─────────────────────────┘

IAMUserSSHKeys                    #AWS managed POLICY. Grants all SSH_PUBLIC_KEY PACTIONs

                                  ┌────────────────────────┐
                                  │   SSH PUBLIC KEY API   │
                                  └────────────────────────┘

UploadSSHPublicKey()              #Req: SSH_PUBLIC_KEY
                                  #  - no SSHPulbicKeyId, UploadDate, Status, Encoding, Fingerprint
                                  #Res: SSHPublicKey SSH_PUBLIC_KEY
                                  #  - no Encoding
UpdateSSHPublicKey()              #Req: SSH_PUBLIC_KEY
                                  #  - no UploadDate, SSHPublicKeyBody, Encoding, Fingerprint
                                  #Res: empty
GetSSHPublicKeys()                #Req: SSH_PUBLIC_KEY
                                  #  - only SSHPublicKeyId, UserName, Encoding
                                  #Res: SSHPublicKey SSH_PUBLIC_KEY
                                  #  - no Encoding
ListSSHPublicKey()                #Req: SSH_PUBLIC_KEY
                                  #  - only UserName
                                  #Res: SSHPublicKeys SSH_PUBLIC_KEY_ARR
                                  #  - no Encoding
DeleteSSHPublicKey()              #Req: SSH_PUBLIC_KEY
                                  #  - only SSHPublicKeyId, UserName
                                  #Res: empty

                                  ┌────────────┐
                                  │   POLICY   │
                                  └────────────┘

POLICY                            #Set of permissions.
                                  #Max 1500 (flexible to 5000) (SUMMARY_MAP.Policies[Quota])
                                  #WAIT (GetPolicy()) PolicyExists: when it exists
POLICY.Arn                        #POLICY_ARN. 'arn:aws:iam::ACCOUNT_ID:policy[/PATH]/POLICY'
POLICY.PolicyId                   #POLICY_MID
POLICY.PolicyName                 #'POLICY'
POLICY.Path                       #NAMEPATH (def: '/')
POLICY.CreateDate                 #'DATE'
POLICY.UpdateDate                 #'DATE'
POLICY.Description                #STR
POLICY.PolicyDocument             #POLICY_DOC
POLICY.IsAttachable               #BOOL (def: true). If false, disabled.

POLICY.Tags                       #AWS_TAGS
                                  #RESOURCE_NAME: PolicyArn POLICY_ARN

                                  ┌────────────────┐
                                  │   POLICY API   │
                                  └────────────────┘

CreatePolicy()                    #Req: POLICY
                                  #  - no Arn, PolicyId, CreateDate, UpdateDate, IsAttachable, DefaultVersionId, PermissionsBoundaryUsageCount, AttachmentCount
                                  #Res: Policy POLICY
                                  #  - no PolicyDocument
GetPolicy()                       #Req: POLICY
                                  #  - only Arn -> PolicyArn
                                  #Res: Policy POLICY
                                  #  - no PolicyDocument
ListPolicies()                    #Req:
                                  #  - Path -> PathPrefix
                                  #  - OnlyAttached BOOL (def: false): if true, only if AttachmentCount > 0
                                  #  - PolicyUsageFilter 'PermissionsBoundary' or 'PermissionsPolicy'
                                  #  - Scope 'AWS', 'Local' or 'All' (def): whether AWS|customer managed policy
                                  #Res: Policies POLICY_ARR
                                  #  - no PolicyDocument
ListPoliciesGrantingServiceAccess #Return policies for a given UGROLE on a given AWS service
 ()                               #Req:
                                  #  - Arn UGROLE_ARN
                                  #  - ServiceNamespaces 'SERVICE'_ARR
                                  #Res: PoliciesGrantingServiceAccess ARR:
                                  #  - ServiceNamespace 'SERVICE'
                                  #  - Policies ARR:
                                  #     - EntityType 'USER|GROUP|ROLE'
                                  #     - EntityName STR
                                  #     - PolicyArn POLICY_ARN
                                  #     - PolicyName 'POLICY'
                                  #     - PolicyType 'INLINE' or 'MANAGED'
DeletePolicy()                    #Req: POLICY
                                  #  - only Arn -> PolicyArn
                                  #Res: empty

TagPolicy()
ListPolicyTags()
UntagPolicy()                     #AWS TAGS

                                  ┌───────────────────┐
                                  │   POLICY PULUMI   │
                                  └───────────────────┘

POLICY.namePrefix                 #Randomized suffix for POLICY.PolicyName

                                  ┌─────────────────┐
                                  │   POLICY LINT   │
                                  └─────────────────┘

AWSSamples::IamUsersHavePolicy
 ::Hook                           #Requires POLICY for any USER

                                  ┌────────────────────┐
                                  │   POLICY VERSION   │
                                  └────────────────────┘

POLICY_VERSION                    #Specific state of a given POLICY.
                                  #Each POLICY update creates a new POLICY_VERSION
                                  #Max 1e4 (SUMMARY_MAP.PolicyVersionsInUse[Quota])
                                  #Max 5 per POLICY (SUMMARY_MAP.VersionsPerPolicyQuota)
POLICY_VERSION.VersionId          #POLICY_VERSION_ID. 'vNUM[.*]'
POLICY_VERSION.PolicyArn          #POLICY_ARN
POLICY_VERSION.CreateDate         #'DATE'
POLICY_VERSION.Document           #POLICY_DOC

POLICY.DefaultVersionId           #POLICY_VERSION_ID of the POLICY_VERSION currently used
POLICY_VERSION.IsDefaultVersion   #BOOL (def: false). True when POLICY.DefaultVersionId === POLICY_VERSION.VersionId

                                  ┌────────────────────────┐
                                  │   POLICY VERSION API   │
                                  └────────────────────────┘

CreatePolicyVersion()             #Req: POLICY_VERSION
                                  #  - no VersionId, CreateDate
                                  #  - Document -> PolicyDocument
                                  #  - IsDefaultVersion -> SetAsDefault
                                  #Res: PolicyVersion POLICY_VERSION
                                  #  - no PolicyArn
SetDefaultPolicyVersion()         #Req: POLICY_VERSION
                                  #  - only VersionId, PolicyArn
                                  #Res: empty
GetPolicyVersion()                #Req: POLICY_VERSION
                                  #  - only VersionId, PolicyArn
                                  #Res: PolicyVersion POLICY_VERSION
                                  #  - no PolicyArn
ListPolicyVersions()              #Req: POLICY_VERSION
                                  #  - only PolicyArn
                                  #Res: Versions POLICY_VERSION_ARR
                                  #  - no PolicyArn
DeletePolicyVersion()             #Req: POLICY_VERSION
                                  #  - only VersionId, PolicyArn
                                  #Res: empty

                                  ┌────────────────────────┐
                                  │   POLICY VERSION IAC   │
                                  └────────────────────────┘

AWS::IAM::ManagedPolicy           #Includes RESATTRs: DefaultVersionId

                                  ┌───────────────────┐
                                  │   INLINE POLICY   │
                                  └───────────────────┘

IPOLICY                           #Identity-based POLICY without an ARN, "embedded" to a single UGROLE
IPOLICY.PolicyName                #'POLICY'
IPOLICY.UGROLEName                #STR
IPOLICY.PolicyDocument            #POLICY_DOC
                                  #Max 2KB for USER, 5KB for GROUP, 10KB for ROLE (SUMMARY_MAP.GUROLEPolicySizeQuota)

                                  ┌───────────────────────┐
                                  │   INLINE POLICY API   │
                                  └───────────────────────┘

PutUGROLEPolicy()                 #Req: IPOLICY
                                  #Res: empty
GetUGROLEPolicy()                 #Req: IPOLICY
                                  #  - only PolicyName, UGROLEName
                                  #Res: IPOLICY
ListUGROLEsPolicies()             #Req: IPOLICY
                                  #  - only UGROLEName
                                  #Res: PolicyNames 'POLICY'_ARR
DeleteUGROLEPolicy()              #Req: IPOLICY
                                  #  - only PolicyName, UGROLEName
                                  #Res: empty

                                  ┌───────────────────────┐
                                  │   INLINE POLICY IAC   │
                                  └───────────────────────┘

AWS::IAM::Policy                  #RESPROPs:
                                  #  - PolicyName
                                  #  - Users|Groups|Roles 'USER|GROUP|ROLE'_ARR
                                  #  - PolicyDocument POLICY_DOC_OBJ
                                  #Prefer AWS::IAM::*Policy instead because does not support drift detection
AWS::IAM::User|Group|RolePolicy   #RESPROPs:
                                  #  - PolicyName
                                  #  - UserName|GroupName|RoleName 'USER|GROUP|ROLE'
                                  #  - PolicyDocument POLICY_DOC_OBJ
AWS::IAM::User|Group|Role         #Includes RESPROPs: Policies OBJ_ARR: PolicyName, PolicyDocument POLICY_DOC_OBJ

new Policy(...CARGS[, OPTS])      #CIPOLICY. CKRESOURCE wrapping IPOLICY
                                  #Ignored unless either:
                                  #  - referenced, i.e. CIPOLICY.policyName used
                                  #  - attached to USER|ROLE|GROUP, and POLICY_DOC is not empty
                                  #  - OPTS.force true (def: false)
                                  #Is YGRANTABLE

Policy.fromPolicyName
 (...CARGS, 'POLICY')->ICIPOLICY  #

OPTS|ICIPOLICY.policyName         #'POLICY' (def: 'POLICY')

OPTS|CIPOLICY.document            #CPOLICY_DOC. POLICY.PolicyDocument
OPTS.statements                   #CSTATEMENT_ARR
CIPOLICY
 .addStatements(CSTATEMENT,...)   #

CIPOLICY_OPTS.users|groups|roles  #CUSER|CGROUP|CROLE_ARR
CIPOLICY.attachToUser|Group|Role
 (CUSER|CGROUP|CROLE)             #

ICROLE_OPTS
 .inlinePolicies.CIPOLICY         #CPOLICY_DOC
ICUSER|ICGROUP|ICROLE
 .attachInlinePolicy(CIPOLICY)    #

                                  ┌──────────────────────────┐
                                  │   INLINE POLICY PULUMI   │
                                  └──────────────────────────┘

User|Group|RolePolicy             #IPOLICY

                                  ┌────────────────────┐
                                  │   MANAGED POLICY   │
                                  └────────────────────┘

MPOLICY                           #Identity-based POLICY with its own ARN, "attached" to 0-n UGROLEs
                                  #Max 10 per UGROLE (flexible to 20) (SUMMARY_MAP.AttachedPoliciesPerGUROLEQuota)
                                  #Max 6KB (SUMMARY_MAP.PolicySizeQuota)
MPOLICY.PolicyArn                 #POLICY_ARN
MPOLICY.PolicyName                #'POLICY'
MPOLICY.UGROLEName                #STR

POLICY.AttachmentCount            #NUM of UGROLEs using this as a MPOLICY

                                  ┌─────────────────────────┐
                                  │   MANAGED POLICY AUTH   │
                                  └─────────────────────────┘

COND_KEY iam:PolicyARN            #MPOLICY.PolicyArn. Only for Attach|DetachUGROLEPolicy()

                                  ┌────────────────────────┐
                                  │   MANAGED POLICY API   │
                                  └────────────────────────┘

AttachUGROLEPolicy()              #Req: MPOLICY
                                  #  - only PolicyArn, UGROLEName
                                  #Res: empty
ListAttachedUGROLEPolicies()      #Req: MPOLICY
                                  #  - only UGROLEName
                                  #Res: AttachedPolicies MPOLICY_ARR
                                  #  - no UGROLEName
ListEntitiesForPolicy()           #Req:
                                  #  - PolicyArn
                                  #  - PathPrefix: of POLICY.Path
                                  #  - PolicyUsageFilter: like ListPolicies()
                                  #  - EntityFilter STR among:
                                  #     - 'User', 'Group' or 'Role'
                                  #     - 'AWSManagedPolicy' or 'LocalManagedPolicy' (like ListPolicies())
                                  #Res: PolicyUGROLEs ARR
                                  #  - UGROLEId ARN
                                  #  - UGROLEName STR
DetachUGROLEPolicy()              #Req: MPOLICY
                                  #  - only PolicyArn, UGROLEName
                                  #Res: empty

                                  ┌────────────────────────┐
                                  │   MANAGED POLICY IAC   │
                                  └────────────────────────┘

AWS::IAM::ManagedPolicy           #RESPROPs:
                                  #  - ManagedPolicyName, Path, Description
                                  #  - PolicyDocument POLICY_DOC_OBJ
                                  #  - Users|Groups|Roles 'USER|GROUP|ROLE'_ARR
                                  #RESATTRs: PolicyArn, PolicyId, CreateDate, UpdateDate, IsAttachable, AttachmentCount
AWS::IAM::User|Group|Role         #Includes RESPROPs: ManagedPolicyArns POLICY_ARN_ARR

new ManagedPolicy(...CARGS[,OPTS])#CMPOLICY. CKRESOURCE wrapping MPOLICY
                                  #Is YGRANTABLE

ManagedPolicy
 .fromManagedPolicyArn
 (...CARGS, POLICY_ARN)->ICMPOLICY#
ManagedPolicy
 .fromManagedPolicyName
 (...CARGS, 'POLICY')->ICMPOLICY  #
ManagedPolicy
 .fromAwsManagedPolicyName
 (...CARGS, 'POLICY')->ICMPOLICY  #

OPTS|ICMPOLICY.managedPolicyArn
OPTS|CMPOLICY.managedPolicyName   #MPOLICY.*
OPTS|CMPOLICY.description
OPTS|CMPOLICY.path                #POLICY.*

OPTS|CMPOLICY.document
OPTS.statements
CMPOLICY
 .addStatements(CSTATEMENT,...)   #Like CIPOLICY

OPTS.users|groups|roles
CMPOLICY.attachToUser|Group|Role
 (CUSER|CGROUP|CROLE)             #Like CIPOLICY

CUSER|CGROUP|CROLE_OPTS
 .managedPolicies                 #ICMPOLICY_ARR (def: [])
ICUSER|ICGROUP|ICROLE
 .addManagedPolicy(ICMPOLICY)     #

                                  ┌───────────────────────────┐
                                  │   MANAGED POLICY PULUMI   │
                                  └───────────────────────────┘

User|Group|RolePolicyAttachment   #MPOLICY, to attach 1 POLICY to 1 USER|GROUP|ROLE
                                  #Non-exclusive: can attach that POLICY to other USER|GROUP|ROLEs
PolicyAttachment                  #MPOLICY, to attach 1 POLICY to n USER|GROUP|ROLEs
                                  #Exclusive: cannot attach that POLICY to other USER|GROUP|ROLEs

                                  ┌─────────────────────────┐
                                  │   MANAGED POLICY LINT   │
                                  └─────────────────────────┘

cdk-nag IAMNoInlinePolicy         #Use MPOLICYs, not IPOLICYs

                                  ┌────────────────────────┐
                                  │   AWS MANAGED POLICY   │
                                  └────────────────────────┘

AWS MANAGED POLICY ==>            #MPOLICY created by AWS.
                                  #POLICY_ARN 'arn:aws:iam::aws:policy/NAME'
                                  #As opposed to "customer managed policy"
                                  #Readonly
                                  #Can be generic, i.e. should consider adding custom POLICYs to restrict them further for a given situation
                                  #Possible types:
                                  #  - "job function role":
                                  #     - generic for a common use case or profession
                                  #     - listed below
                                  #  - standard: common policies for ENTITYs|resources using a given SERVICE
                                  #  - SERVICE_LINKED_ROLE
                                  #  - STANDARD_SERVICE_ROLE
                                  #Common suffixes:
                                  #  - *FullAccess: all PACTIONs
                                  #  - *PowerUser: all PACTIONs except permission management
                                  #  - *WriteOnlyAccess|ReadOnlyAccess

AdministratorAccess               #Allow all ACTIONs on all resources
PowerUserAccess                   #Allow all ACTIONs on all resources except for most of IAM|ORG|ACCOUNT
ReadOnlyAccess                    #Allow all read-only ACTIONs on all resources
ViewOnlyAccess                    #Allow read-only ACTIONs on some resources

SupportUser                       #Allow read-only ACTIONs on resources needed for support
SecurityAudit                     #Allow read-only ACTIONs on resources needed for security audits

Billing                           #Allow ACTIONs on:
                                  #  - Billing, Budgets, Cost explorer, Cost and Usage Reports
SystemAdministrator               #Allow ACTIONs on:
                                  #  - Lambda, EC2, S3, Autoscaling, ELB, CloudWatch [Events|Logs], Cloudtrail
                                  #  - Route 53 [Domains]
                                  #  - SES, SNS, SQS
                                  #  - CodeCommit, CodePipeline, CodeDeploy, Config
                                  #  - KMS, Certificate manager, Directory Service, Trusted Advisor
DatabaseAdministrator             #Allow ACTIONs on:
                                  #  - Data pipeline
                                  #  - RDS, Elasticache, Redshift, DynamoDB
                                  #  - Lambda, EC2, S3, CloudWatch [Logs]
DataScientist                     #Allow ACTIONs on:
                                  #  - Sagemaker
                                  #  - EMR, Kinesis, Data pipeline, Firehose, ElasticMapReduce
                                  #  - ElasticSearch, Redshift, DynamoDB
                                  #  - Lambda, EC2, S3, AutoScaling, CloudWatch
NetworkAdministrator              #Allow ACTIONs on:
                                  #  - EC2, ELB, CloudWatch
                                  #  - Route 53 [Domains], Network manager, DirectConnect
                                  #  - SNS

                                  ┌───────────────────────────────┐
                                  │   AWS MANAGED POLICY PULUMI   │
                                  └───────────────────────────────┘

CW.iam.ManagedPolicy.POLICY       #POLICY_ARN

                                  ┌─────────────────────────────┐
                                  │   AWS MANAGED POLICY LINT   │
                                  └─────────────────────────────┘

cdk-nag IAMNoManagedPolicies      #Forbid AWS managed POLICYs

                                  ┌─────────────────────────┐
                                  │   PERMISSION BOUNDARY   │
                                  └─────────────────────────┘

PERM_BOUNDARY                     #Additional POLICY on top of identity-based POLICYs, but evaluated separately.
                                  #Meant to dissociate admin-controlled POLICYs from user-controlled ones
                                  #  - by only giving *PermissionsBoundary* permissions to admins
PERM_BOUNDARY.PermissionsBoundary #POLICY_ARN
PERM_BOUNDARY.UROLEName           #STR

UROLE.PermissionsBoundary         #ATTACHED_PERM_BOUNDARY
ATTACHED_PERM_BOUNDARY
 .PermissionsBoundaryArn          #POLICY_ARN
ATTACHED_PERM_BOUNDARY
 .PermissionsBoundaryType         #Always 'Policy'

POLICY
 .PermissionsBoundaryUsageCount   #NUM of UROLEs using POLICY as PERM_BOUNDARY

                                  ┌──────────────────────────────┐
                                  │   PERMISSION BOUNDARY AUTH   │
                                  └──────────────────────────────┘

COND_KEY                          #ATTACHED_PERM_BOUNDARY.PermissionsBoundaryArn. PRINCIPAL's PERM_BOUNDARY
 iam:PermissionsBoundary          #Only for PACTIONs *PermissionsBoundary(), Attach|Detach|Put|DeleteUROLEPolicy(), CreateUROLE()

                                  ┌─────────────────────────────┐
                                  │   PERMISSION BOUNDARY API   │
                                  └─────────────────────────────┘

PutUROLEPermissionsBoundary()     #Req: PERM_BOUNDARY
                                  #Res: empty
DeleteUROLEPermissionsBoundary()  #Req: PERM_BOUNDARY
                                  #  - only UROLEName
                                  #Res: empty

                                  ┌─────────────────────────────┐
                                  │   PERMISSION BOUNDARY IAC   │
                                  └─────────────────────────────┘

AWS::IAM::User|Role               #Includes RESPROPs: PermissionsBoundary PERM_BOUNDARY_ARN
AWS::IAM::ManagedPolicy           #Includes RESATTRs: PermissionsBoundaryUsageCount

SSOPTS|SOPTS.permissionsBoundary  #CSTACK_PERM_BOUNDARY
                                  #Set RESPROP PermissionsBoundary PERM_BOUNDARY_ARN for all USERs|ROLEs of the STACK
CVAR
 @aws-cdk/core:permissionsBoundary#Same as { name: 'PERM_BOUNDARY' } or { arn: PERM_BOUNDARY_ARN }

PermissionsBoundary
 .fromName('PERM_BOUNDARY'_BSTR)
 ->CSTACK_PERM_BOUNDARY           #
PermissionsBoundary
 .fromArn(PERM_BOUNDARY_ARN_BSTR)
 ->CSTACK_PERM_BOUNDARY           #

PermissionsBoundary
 .of(CONSTRUCT)->CPERM_BOUNDARY   #Set RESPROP PermissionsBoundary PERM_BOUNDARY_ARN for all USERs|ROLEs of the CONSTRUCT
CPERM_BOUNDARY.apply(ICMPOLICY)   #
CPERM_BOUNDARY.clear()            #

CUSER|CROLE[_OPTS]
 .permissionsBoundary             #ICMPOLICY

                                  ┌──────────────────────────────┐
                                  │   PERMISSION BOUNDARY LINT   │
                                  └──────────────────────────────┘

AWSSamples::IAMPrincipalBoundary
 ::Hook                           #Requires PERM_BOUNDARY
ETYPE_CONF.iamPrincipalBoundaryArn#POLICY_ARN
ETYPE_CONF
 .excludedPrincipalSuffixes       #'ROLE|USER,...' (def: none) that do not require the PERM_BOUNDARY

                                  ┌──────────────────┐
                                  │   POLICY TYPES   │
                                  └──────────────────┘

POLICY TYPES ==>                  #  - resource-based: see STATEMENT.Principal
                                  #  - ACL
                                  #  - identity-based: see STATEMENT.Resource and IPOLICY|MPOLICY
                                  #  - PERM_BOUNDARY
                                  #  - session: see STS *_REQ.Policy
                                  #  - organization SCP

IDENTITY-BASED POLICY ==>         #POLICY attached to a PRINCIPAL
                                  #As IPOLICY|MPOLICY, using Put|AttachUGROLEPolicy()

RESOURCE-BASED POLICY ==>         #POLICY attached to a resource
                                  #Using resource-specific ACTIONs
                                  #  - only some resources have such ACTIONs

ACL ==>                           #"Access Control List"
                                  #Like resource-based POLICY but:
                                  #  - SERVICE-specific
                                  #     - e.g. S3, VPC and WAF
                                  #  - does not use POLICY_DOC but specific syntax
                                  #  - only for PRINCIPALs in other ACCOUNTs, or unauthenticated

POLICY TYPES INTERACTION ==>      #Usually, allow action if matches either:
                                  #  - all of:
                                  #     - resource-based (required)
                                  #     - ACL (optional)
                                  #  - all of:
                                  #     - identity-based (required)
                                  #     - PERM_BOUNDARY (optional)
                                  #     - session (required if FEDERATED_USER)
                                  #However, must match both if PRINCIPAL either:
                                  #  - has different ACCOUNT than resource ("cross-account")
                                  #  - is ROLE (as opposed to ASSUMED_ROLE)
                                  #  - is FEDERATED_USER's parent USER (as opposed to normal USER, or to FEDERATED_USER itself)
                                  #Also, must always match ORG policy (optional)

POLICY TYPES MATCH ==>            #If 0 STATEMENT.Effect 'Allow' matches, deny that policy type (not others)
                                  #If 1 STATEMENT.Effect 'Deny' matches, deny all policy types

MULTIPLE POLICY_DOCS ==>          #Some policy types can have multiple POLICY_DOCs: resource-based, ACL, identity-based, organization SCP
                                  #They are and'd, as if their STATEMENTs were concatenated to a single POLICY_DOC

BEST PRACTICES ==>                #Grant least privilege

                                  ┌───────────────┐
                                  │   GRANT IAC   │
                                  └───────────────┘

CYPOLICY                          #Identity-based CIPOLICY|CMPOLICY
                                  #Always a DEPENDABLE

YGRANTABLE                        #Entity that uses CYPOLICYs
YGRANTABLE.grantPrincipal         #ICPRINCIPAL of the entity
ICPRINCIPAL.addToPrincipalPolicy  #Add STATEMENT to the CYPOLICY. Returns OBJ:
 (CSTATEMENT)->OBJ                #  - statementAdded BOOL: false if no CYPOLICY
                                  #     - including when no parent YGRANTABLE entity
                                  #  - policyDependable CYPOLICY
ICPRINCIPAL.principalAccount      #'ACCOUNT_ID' of the entity's ICPRINCIPAL
                                  #Optional. When there is a related CKRESOURCE, often set to CKRESOURCE.env.account
                                  #Used by Grant.addToPrincipalOrResource() for cross-account permissions

KGRANTABLE                        #CKRESOURCE with an underlying ROLE
                                  #Is often also YGRANTABLE, but not always
KGRANTABLE.role                   #ICROLE. Often present, but sometimes called differently
KGRANTABLE
 .addToRolePolicy(CSTATEMENT)     #Calls ROLE.addToPrincipalPolicy(), i.e. add inline POLICY to it

CRPOLICY                          #Resource-based POLICY (e.g. POLICY_DOC, Lambda PERMISSION, etc.)
                                  #Always a DEPENDABLE

RGRANTABLE                        #CKRESOURCE that uses CRPOLICYs
RGRANTABLE.addToResourcePolicy    #Add STATEMENT to the CRPOLICY
 (CSTATEMENT)->OBJ                #Returns OBJ: statementAdded BOOL, policyDependable DEPENDABLE

CGRANT                            #STATEMENT added to a YGRANTABLE's CYPOLICY or a RGRANTABLE's CRPOLICY
                                  #Is DEPENDABLE, depending on underlying C*POLICY, i.e. ensure C*POLICYs are created first
CGRANT.principalStatements        #CSTATEMENT_ARR for CYPOLICYs
CGRANT.resourceStatements         #CSTATEMENT_ARR for CRPOLICYs
CGRANT.success                    #BOOL. Whether there are some CSTATEMENTs
CGRANT.assertSuccess()            #Throw if success false
CGRANT.applyBefore(CONSTRUCT_ARR) #Ensure underlying STATEMENT is granted before CONSTRUCTs are deployed
                                  #Possible reasons:
                                  #  - permissions needed for the deploy itself, as opposed to the deployed RESOURCEs
                                  #     - e.g. POLICYs used by a CUSTOM_RESOURCE's Lambda logic, i.e. called during deploy
                                  #        - however, this is automatically handled by CUSTOM_RESOURCE's CDK helpers
                                  #  - some SERVICEs require ROLEs to have POLICYs already attached before being associated to a resource
                                  #     - this is meant for validation purpose
CGRANT.combine(CGRANT2)->CGRANT3  #

Grant.addToPrincipal(OPTS)->CGRANT#Does identity-based CGRANT, i.e. YGRANTABLE.grantPrincipal.addToPrincipalPolicy() with a new STATEMENT
OPTS.grantee                      #YGRANTABLE
OPTS.actions                      #'PACTION'_ARR. STATEMENT.Action
OPTS.resourceArns                 #'ARN'_ARR. STATEMENT.Resource
OPTS.conditions                   #COND_OBJ. STATEMENT.Condition

Grant.addToPrincipalAndResource   #Does identity-based CGRANT
 (OPTS)->CGRANT                   #Then does resource-based CGRANT, i.e. RGRANTABLE.addToResourcePolicy() with a new STATEMENT
OPTS.grantee                      #YGRANTABLE
OPTS.resource                     #RGRANTABLE
OPTS.actions                      #'PACTION'_ARR. STATEMENT.Action, identity|resource-based
OPTS.resourceArns                 #'ARN'_ARR. STATEMENT.Resource, identity|resource-based
OPTS.resourceSelfArns             #'ARN'_ARR. STATEMENT.Resource, resource-based
OPTS.resourcePolicyPrincipal      #ICPRINCIPAL (def: YGRANTABLE.grantPrincipal). STATEMENT.Principal, resource-based
OPTS.conditions                   #COND_OBJ. STATEMENT.Condition, identity-based

Grant.addToPrincipalOrResource    #Does identity-based CGRANT
 (OPTS)->CGRANT                   #If fails, does resource-based CGRANT
                                  #If cross-account, always does both
                                  #  - this is required by IAM for cross-account permissions
                                  #  - using YGRANTABLE.grantPrincipal.principalAccount
OPTS.*                            #Like addToPrincipalAndResource() except:
                                  #  - no OPTS.resourcePolicyPrincipal (always use YGRANTABLE.grantPrincipal)

Grant.drop(YGRANTABLE)->CGRANT    #Noop, i.e. no new STATEMENTs

CKRESOURCE.grant                  #Method available with many CKRESOURCEs that have CYPOLICYs|CRPOLICYs
 (YGRANTABLE, 'ACTION',...[, ...])#Calls Grant.addToPrincipal*(OPTS) with some OPTS.* already set
 ->CGRANT                         #Should usually check CGRANT.[assert]success too
CKRESOURCE.grantACTIONS
 (YGRANTABLE[, ...])->CGRANT      #Same but also with specific ACTIONs

                                  ┌─────────────────────┐
                                  │   POLICY DOCUMENT   │
                                  └─────────────────────┘

POLICY_DOC                        #List of permissions of a POLICY
                                  #JSON-stringified, URL-encoded.
                                  #  - When using CloudFormation, can use YAML instead.
                                  #UI at http://awspolicygen.s3.amazonaws.com/policygen.html
POLICY_DOC.Version                #'2012-10-17'
POLICY_DOC.Id                     #POLICY_DOC_ID.
                                  #Optional. Only allowed in resource-based POLICYs
                                  #When used, a UUID is recommended.
                                  #Used only by a few SERVICEs, like SQS|SNS

                                  ┌─────────────────────────┐
                                  │   POLICY DOCUMENT IAC   │
                                  └─────────────────────────┘

new PolicyDocument([OPTS])        #CPOLICY_DOC. RV that resolves to POLICY_DOC_OBJ

CPOLICY_DOC.toString()->STR_TK    #Resolving to CPOLICY_DOC
CPOLICY_DOC.toJSON()
 ->POLICY_DOC_OBJ                 #Unlike RV resolution, does not apply OPTS.minimize|assignSids
PolicyDocument.fromJson
 (POLICY_DOC_OBJ)->CPOLICY_DOC    #

OPTS.statements                   #CSTATEMENT_ARR
CPOLICY_DOC
 .addStatements(CSTATEMENT,...)   #
CPOLICY_DOC.statementCount        #NUM
CPOLICY_DOC.isEmpty               #BOOL

CVAR                              #BOOL (recommended) (def: false)
 @aws-cdk/aws-iam:minimizePolicies#Merge STATEMENTs to make POLICY_DOC smaller, without changing semantics
OPTS.minimize                     #Not if STATEMENT.Sid set
                                  #Also sorts STATEMENT.Action|Resource|Principal
                                  #Regardless, duplicate STATEMENTs are always ignored

LARGE POLICY_DOC ==>              #If POLICY_DOC is larger than limit, split it into several MPOLICYs 'OverflowPolicyCOUNT'
                                  #Only when it is part of a ROLE's IPOLICY|MPOLICY
CVAR                              #NUM (in bytes, def: 150). Average size of ARNs
 @aws-cdk/aws-iam.arnSizeEstimate #Used when splitting large POLICY_DOCs and some ARNs are unresolved RVs

OPTS.assignSids                   #BOOL (def: false). Sets default STATEMENT.Sid with incrementing NUM

                                  ┌────────────────────────────┐
                                  │   POLICY DOCUMENT PULUMI   │
                                  └────────────────────────────┘

'POLICY_DOC_JSON'                 #POLICY_DOC
POLICY_DOC_OBJ                    #Alternative. TypeScript type CW.iam.PolicyDocument

                                  ┌──────────────────────────┐
                                  │   POLICY DOCUMENT LINT   │
                                  └──────────────────────────┘

cfn-lint E3510                    #Valid identity-based POLICY_DOC
cfn-lint E3512                    #Valid resource-based POLICY_DOC
cfn-lint W2511                    #Validate POLICY_DOC.Version in resource-based POLICY_DOC

                                  ┌───────────────────────┐
                                  │   POLICY STATEMENTS   │
                                  └───────────────────────┘

POLICY.Statement                  #STATEMENT_ARR
                                  #Statements are and'd
STATEMENT                         #Single permission
STATEMENT.Sid                     #STR. Identifier, used mostly for description

STATEMENT.Effect                  #'Allow|Deny'
STATEMENT.Action                  #PACTION[_ARR]. Either ACTION or "Permission-only action":
                                  #  - like ACTION, but can only be used in IAM POLICYs
                                  #  - does not refer to an actual REST method
                                  #Can use wildcard *
                                  #  - 'SERVICE:*' required for the very few SERVICEs without ACTIONs

STATEMENT.Resource                #Resource ARN[_ARR]
                                  #Mostly meant for identity-based POLICYs
                                  #Can use in resource-based POLICYs, but default to current resource
                                  #Can use globbing wildcards * ?
                                  #'Resource-level permissions':
                                  #  - not using '*' for [RESOURCE_TYPE:][NAMEPATH/]NAME
                                  #  - not possible with some resources|SERVICEs
STATEMENT.Principal               #PRINCIPAL
                                  #Only for resource-based POLICYs
                                  #OBJ:
                                  #  - AWS STR among:
                                  #     - ROOT_ARN|ACCOUNT_ID
                                  #     - USER_ARN
                                  #     - FEDERATED_USER_ARN
                                  #     - [ASSUMED_]ROLE_ARN
                                  #     - '*'
                                  #  - CanonicalUser CANONICAL_ACCOUNT_ID
                                  #  - Federated 'SAML_PROVIDER_ARN|WEB_ID_DOMAIN'
                                  #  - Service 'SERVICE_DOMAIN'
                                  #     - can be combined with AWS STR
                                  #'*': shortcut for {AWS: '*'}
                                  #Every value can optionally be an ARR
                                  #Can also use MID instead of ARN
                                  #  - ARN are converted to MID on create|update
                                  #     - so that NAME changes do not impact POLICY_DOC

STATEMENT.NotAction               #Like STATEMENT.Action|Resource|Principal but using inverted list.
STATEMENT.NotResource             #Cannot use both STATEMENT.* and STATEMENT.Not*
STATEMENT.NotPrincipal            #With NotPrincipal:
                                  #  - should include ASSUMED_ROLE -> ROLE -> USER -> ROOT
                                  #  - e.g. if ROLE, should include USER|ROOT too

                                  ┌───────────────────────────┐
                                  │   POLICY STATEMENTS IAC   │
                                  └───────────────────────────┘

new PolicyStatement([OPTS])       #CSTATEMENT

CSTATEMENT.to[Statement]Json()
 ->STATEMENT_OBJ                  #
PolicyStatement.fromJson
 (STATEMENT_OBJ)->CSTATEMENT      #
CSTATEMENT.copy
 ([OPTS])->CSTATEMENT2            #OPTS: like new PolicyStatement()
CSTATEMENT.toString()->STR_TK     #Resolves to CSTATEMENT

OPTS|CSTATEMENT.sid
OPTS|CSTATEMENT.effect            #STATEMENT.*

OPTS|CSTATEMENT.[not]actions
CSTATEMENT                        #'PACTION'_ARR. STATEMENT.Action
 .add[Not]Actions('PACTION',...)  #Ignore duplicate items

OPTS|CSTATEMENT.[not]resources
CSTATEMENT                        #'ARN'_ARR. STATEMENT.Resource
 .add[Not]Resources('ARN',...)    #Ignore duplicate items
CSTATEMENT.addAllResources()      #Same as CSTATEMENT.addResources('*')
CSTATEMENT.hasResource            #BOOL

CSTATEMENT|CPOLICY_DOC
 .validateForAnyPolicy()          #General validation
 ->'ERROR'_ARR                    #STATEMENT.notActions|actions must not both be used
CSTATEMENT|CPOLICY_DOC            #Validation for resource-based POLICYs
 .validateForResourcePolicy()     #Like validateForAnyPolicy() + at least one STATEMENT.[not]principal must exist
 ->'ERROR'_ARR                    #Run automatically by most CKRESOURCEs that have resource-based POLICYs (CROLE, CBUCKET, CTOPIC, etc.)
CSTATEMENT|CPOLICY_DOC            #Validation for identity-based POLICYs
 .validateForIdentityPolicy()     #Like validateForAnyPolicy() + at least one STATEMENT.[not]resource must exist
 ->'ERROR'_ARR                    #Also, must not use STATEMENT.[not]principal
                                  #Run automatically on C[M]POLICY and CROLE's inline POLICYs

CSTATEMENT.freeze()->CSTATEMENT   #Makes read-only
CSTATEMENT.frozen                 #BOOL (def: false)

                                  ┌────────────────────────────┐
                                  │   POLICY STATEMENTS LINT   │
                                  └────────────────────────────┘

cfn-lint-serverless
 aws_iam_role_lambda_no_star
 (WS1003)                         #STATEMENT.Action not allowed with IPOLICY (unlike MPOLICY)

cdk-nag IAMNoWildcardPermissions  #No STATEMENT.Action|Resource '*'
cdk-nag IAMPolicyNoStatements
 WithFullAccess                   #No STATEMENT.Action '*' or '...:*' + STATEMENT.Effect 'Allow'
cdk-nag IAMPolicyNoStatements
 WithAdminAccess                  #No STATEMENT.Action '*' + STATEMENT.Resource '...:*' + STATEMENT.Effect 'Allow'

cfn-lint W3037                    #Valid STATEMENT.Action
                                  #Experimental

AWSSamples                        #Forbids using * with STATEMENT.Action|Resource
 ::IamPolicyDoesNotGiveAdmin      #DEPENDENT_ACTIONs perform other ACTIONs under the hood
 ::Hook                           #  - i.e. require permissions for those too

IAM LEGEND ==>                    #VSCode extension to autocomplete STATEMENT.action and show doc in popover

                                  ┌────────────────────────┐
                                  │   PRINCIPAL CORE IAC   │
                                  └────────────────────────┘

OPTS|CSTATEMENT.[not]principals   #ICPRINCIPAL_ARR
                                  #Ignore duplicate items
CSTATEMENT.add[Not]Principals
 (ICPRINCIPAL_ARR)                #
CSTATEMENT.hasPrincipal           #BOOL

ICPRINCIPAL                       #PRINCIPAL

new PrincipalBase()               #CPRINCIPAL base class. PRINCIPAL in STATEMENT.[Not]Principal
                                  #Is ICPRINCIPAL but with a few additional members

CPRINCIPAL_OBJ                    #{ KEY: STR_ARR, ... }. STATEMENT.Principal
ICPRINCIPAL.policyFragment
new PrincipalPolicyFragment
 (CPRINCIPAL_OBJ)                 #CPRINCIPAL_FRAGMENT. Wraps CPRINCIPAL_OBJ
CPRINCIPAL_FRAGMENT.principalJson #CPRINCIPAL_OBJ
CPRINCIPAL.toJSON()
 ->CPRINCIPAL_OBJ                 #
CPRINCIPAL.toString()->STR        #JSON.stringify(CPRINCIPAL_OBJ)

CPRINCIPAL.dedupeString()[->STR]  #If two CPRINCIPALs return same STR, considered duplicates, i.e. can remove one
                                  #Used when merging CSTATEMENTs, e.g. by CPOLICY_DOC OPTS.minimize
ComparablePrincipal
 .isComparablePrincipal
 (CPRINCIPAL)->BOOL               #Whether CPRINCIPAL.dedupeString is defined
ComparablePrincipal
 .dedupeStringFor
 (CPRINCIPAL)[->STR]              #Forwards to dedupeString(), if defined

new CompositePrincipal
 (ICPRINCIPAL,...)                #CPRINCIPALS. CPRINCIPAL merging multiple ICPRINCIPALs
CPRINCIPALS.addPrincipals
 (ICPRINCIPAL,...)                #

                                  ┌────────────────────────┐
                                  │   PRINCIPAL LIST IAC   │
                                  └────────────────────────┘

new StarPrincipal()               #CPRINCIPAL with '*' (shortcut for { AWS: '*' })

CSTATEMENT.addAnyPrincipal()
new AnyPrincipal()                #CPRINCIPAL with { AWS: '*' }

CSTATEMENT.addArnPrincipal('ARN')
new ArnPrincipal('ARN')           #CARN_PRINCIPAL. CPRINCIPAL with { AWS: ARN }
CARN_PRINCIPAL
 .inOrganization('ORG_ID')
 ->CCOND_PRINCIPAL                #Adds COND_OBJ { StringEquals: { aws:PrincipalOrgID: 'ORG_ID' } }
new OrganizationPrincipal('ORGID')#Like new ArnPrincipal('*').inOrganization('ORG_ID')

CSTATEMENT.addAwsAccountPrincipal
 ('ACCOUNT_ID')                   #CPRINCIPAL with { AWS: ACCOUNT_ID }
new AccountPrincipal('ACCOUNT_ID')#Also sets CPRINCIPAL.principalAccount
CSTATEMENT
 .addAccountRootPrincipal()
new AccountRootPrincipal()        #Same but using current CSTACK.account

CSTATEMENT
 .addCanonicalUserPrincipal
 ('CANONICAL_ACCOUNT_ID')
new CanonicalUserPrincipal
 ('CANONICAL_ACCOUNT_ID')         #CPRINCIPAL with { CanonicalUser: 'CANONICAL_ACCOUNT_ID' }

CSTATEMENT.addServicePrincipal
 ('SERVICE'[, OPTS])
new ServicePrincipal
 ('SERVICE'[, OPTS])              #CPRINCIPAL with { Service: 'SERVICE_DOMAIN'_TK }
OPTS.conditions                   #COND_OBJ
OPTS.region                       #'REGION'
ServicePrincipal
 .servicePrincipalName
 ('SERVICE')->'SERVICE_DOMAIN'_TK #
CVAR @aws-cdk/aws-iam:            #If true (recommended), always return 'SERVICE[.REGION].amazonaws.com'
 standardizedServicePrincipals    #If false (def), uses RFACTs, which used to be needed for some edge cases, but not anymore

CSTATEMENT.addFederatedPrincipal
 (STR, COND_OBJ)
new FederatedPrincipal
 (STR[, COND_OBJ])                #CPRINCIPAL with { Federated: STR }

new UnknownPrincipal(OPTS)        #ICPRINCIPAL that needs to be replaced by another one
                                  #Throws or warns when used
OPTS.resource                     #CONSTRUCT

                                  ┌───────────────────────────┐
                                  │   PRINCIPAL LIST PULUMI   │
                                  └───────────────────────────┘

CW.iam.Principals
 .SERVICEPrincipal.Service        #'SERVICE_DOMAIN'

                                  ┌─────────────────────────┐
                                  │   CONDITION OPERATORS   │
                                  └─────────────────────────┘

STATEMENT.Condition               #VAL2
 .CONDITION_OP.COND_KEY           #Applies STATEMENT only if CONDITION_OP(COND_KEY, VAL2) is true
                                  #Each CONDITION_OP|COND_KEY is and'd
                                  #VAL2 can be an ARR, in which case each item is or'd

GLOB                              #Can only use: * ?
BOOL                              #"true|false", not true|false

CONDITION_OP                      #Any of the following.

ForAnyValue:CONDITION_OP
 (VAL_ARR, VAL2)                  #CONDITION_OP(VAL, VAL2) || ...
ForAllValue:CONDITION_OP
 (VAL_ARR, VAL2)                  #CONDITION_OP(VAL, VAL2) && ...

CONDITION_OPIfExists
 (VAL, VAL2)                      #CONDITION_OP(VAL, VAL2) || VAL === undefined
Null(VAL, BOOL)                   #VAL ===|!== undefined

Bool(BOOL, BOOL2)                 #BOOL === BOOL2

String[Not]Equals[IgnoreCase]
 (STR, STR2)                      #STR ===|!== STR2
String[Not]Like(STR, 'GLOB')      #STR =~|!=~ 'GLOB'

Numeric[Not]Equals(NUM, NUM2)     #NUM ===|!== NUM2
NumericLess|GreaterThan[Equals]
 (NUM, NUM2)                      #NUM <|<=|>|>= NUM2

Date[Not]Equals('DATE', 'DATE2')  #'DATE' ===|!== 'DATE2'
DateLess|GreaterThan[Equals]
 ('DATE', 'DATE2')                #'DATE' <|<=|>|>= 'DATE2'

BinaryEquals(BUFFER, 'BASE64')    #BUFFER === 'BASE64'

Arn[Not]Equals('ARN', 'ARN2')     #'ARN' ===|!== 'ARN2'
Arn[Not]Like('ARN', 'GLOB')       #'ARN' =~|!=~ 'GLOB'

[Not]IpAddress('IP', 'IP2')       #'IP' =~ 'IP2'
                                  #Can be IPv4|v6
                                  #Can append '/MASK'

                                  ┌───────────────────┐
                                  │   CONDITION KEY   │
                                  └───────────────────┘

COND_KEY                          #Also named "context key"
                                  #Name is case-insensitive.
                                  #Can be either:
                                  #  - "global": aws:*
                                  #  - "service-specific": see in SERVICE's own doc
                                  #Many can only be used when using a specific STATEMENT.Action|Resource
${COND_KEY[, 'DEFAULT']}          #"Policy variable". Can be used in:
                                  #  - CONDITION_OP.COND_KEY value
                                  #  - STATEMENT.Resource value
                                  #Can preprend|append STR
                                  #Type of policy variable (and COND_KEY) must:
                                  #  - be STR|ARN
                                  #  - not be ARR
                                  #If policy variable is undefined:
                                  #  - 'DEFAULT' is used
                                  #  - otherwise whole value becomes undefined
                                  #     - should take that case into account when writing POLICY_DOC
                                  #Can escape * ? $ using ${CHAR}

aws:PrincipalType                 #"Account|User|FederatedUser|AssumedRole|Anonymous"
aws:username                      #'USER'
                                  #undefined unless PrincipalType 'User'
aws:userid                        #Depending on PrincipalType:
                                  #  - "Account": ACCOUNT_ID
                                  #  - "User": USER_MID
                                  #  - "FederatedUser": 'ACCOUNT_ID:FEDERATED_USER'
                                  #  - "AssumedRole": 'ROLE_MID:ASSUMED_ROLE|INSTANCE_PROFILE_MID'
                                  #  - "Anonymous": 'anonymous'
aws:PrincipalAccount              #'ACCOUNT_ID|anonymous' of the PRINCIPAL
aws:PrincipalArn                  #ROOT|USER|FEDERATED_USER|ROLE_ARN of the PRINCIPAL
                                  #If ASSUMED_ROLE, use ROLE_ARN
                                  #undefined if anonymous

aws:ResourceAccount               #'ACCOUNT_ID' of the resource
aws:RequestedRegion               #'REGION' of the resource
                                  #'us-east-1' for SERVICEs that are not REGION-specific

aws:CurrentTime                   #'DATE'
aws:EpochTime                     #DATE_NUM

aws:SecureTransport               #BOOL. Whether the request is HTTPS
aws:SourceIp                      #'IP' of the request
aws:UserAgent                     #STR. Value of User-Agent [C]
aws:Referer                       #STR. Value of Referer [C]

                                  ┌───────────────────┐
                                  │   CONDITION IAC   │
                                  └───────────────────┘

COND_OBJ                          #{ CONDITION_OP: { COND_KEY: VAL } }. STATEMENT.Condition
CSTATEMENT[_OPTS]|CCOND_PRINCIPAL
 .conditions                      #COND_OBJ
CSTATEMENT|CCOND_PRINCIPAL
 .addConditions(COND_OBJ)         #
CSTATEMENT|CCOND_PRINCIPAL
 .addCondition('CONDITION_OP',
 { COND_KEY: VAL })               #

CPRINCIPAL.withConditions
 (COND_OBJ)->CCOND_PRINCIPAL
new PrincipalWithConditions
 (ICPRINCIPAL, COND_OBJ)          #CCOND_PRINCIPAL. Like CPRINCIPAL, except merges additional STATEMENT.Condition

new PrincipalPolicyFragment       #Adds related COND_OBJ.
 (..., COND_OBJ)                  #All STATEMENT's ICPRINCIPALs must have same one
CPRINCIPAL_FRAGMENT.conditions    #COND_OBJ

                                  ┌────────────────┐
                                  │   SIMULATION   │
                                  └────────────────┘

SIMULATION                        #Dry run of POLICYs on a given action + resources
                                  #UI at https://policysim.aws.amazon.com/
SIMULATION.ActionNames            #PACTION_ARR
                                  #Can only use '*' when using SIMULATION.PolicySourceArn
SIMULATION.PolicySourceArn        #GUROLE_ARN. Use its attached POLICYs
SIMULATION.CallerArn              #USER_ARN used when evaluating any STATEMENT.Principal
                                  #Def: SIMULATION.PolicySourceArn (if defined)
SIMULATION.PolicyInputList        #Identity-based POLICY_DOC_ARR attached to the PRINCIPAL
SIMULATION.PermissionsBoundary
 PolicyInputList                  #PERM_BOUNDARY-based POLICY_DOC_ARR attached to the PRINCIPAL
SIMULATION.ResourcePolicy         #Resource-based POLICY_DOC attached to the resources
                                  #Def: none, even if the resource actually has one
SIMULATION.ResourceArns           #ARN_ARR of the resources
                                  #Can point to non-existing resources
                                  #Def: '*'
SIMULATION.ResourceOwner          #ROOT_ARN of the owner of the resources and SIMULATION.ResourcePolicy
                                  #Def: SIMULATION.CallerArn
                                  #Only needed if:
                                  #  - SIMULATION.ResourcePolicy used
                                  #  - SIMULATION.ResourceArns do not include ACCOUNT_ID (e.g. S3 BUCKET|OBJECTs)
SIMULATION.ResourceHandlingOption #'EC2-VPC-InstanceStore|EBS[-Subnet]'. For EC2, requires the presence of the following resources
                                  #in SIMULATION.ResourceArns:
                                  #  - 'EBS': VOLUME
                                  #  - '-Subnet': SUBNET

SIMULATION.ContextEntries         #CONTEXT_ENTRY_ARR
CONTEXT_ENTRY                     #COND_KEY to use in the POLICY_DOCs
CONTEXT_ENTRY.ContextKeyType      #'boolean|string|numeric|date|binary|ip[List]'
CONTEXT_ENTRY.ContextKeyName      #'COND_KEY'
CONTEXT_ENTRY.ContextKeyValues    #VAL_ARR. COND_KEY value.

EVAL_RESULT                       #Result of a SIMULATION
EVAL_RESULT
 .ResourceSpecificResults         #EVAL_RESOURCE_RESULT. Resource-specific result
EVAL_RESULT.EvalActionName        #PACTION
EVAL[_RESOURCE]_RESULT
 .EvalResourceName                #ARN
EVAL_RESULT.EvalDecision
EVAL_RESOURCE_RESULT
 .EvalResourceDecision            #'allowed' or 'explicit|implicitDeny'
EVAL[_RESOURCE]_RESULT
 .PermissionsBoundary
  DecisionDetail
 .AllowedByPermissionsBoundary    #BOOL. False if action was denied due to a PERM_BOUNDARY's POLICY
EVAL_RESULT
 .OrganizationDecisionDetail
 .AllowedByOrganizations          #BOOL. False if action was denied due to a organization's POLICY (SCP)
EVAL[_RESOURCE]_RESULT
 .MissingContextValues            #'COND_KEY'_ARR used in a POLICY but not supplied as SIMULATION.ContextEntries

EVAL[_RESOURCE]_RESULT
 .MatchedStatements               #EVAL_STATEMENT_ARR that were used
EVAL_STATEMENT.SourcePolicyId     #POLICY_ARN
EVAL_STATEMENT.SourcePolicyType   #One of:
                                  #  - 'user|group|role': IPOLICY
                                  #  - 'aws-managed|user-managed': MPOLICY
                                  #  - 'resource'
                                  #  - 'none'
EVAL_STATEMENT
 .Start|EndPosition.Column|Line   #NUM

EVAL[_RESOURCE]_RESULT
 .EvalDecisionDetails             #EVAL_DETAIL_ARR
EVAL_DETAIL                       #Explanation of why the action was allowed|denied
EVAL_DETAIL.key                   #STR
EVAL_DETAIL.value                 #STR

                                  ┌────────────────────┐
                                  │   SIMULATION API   │
                                  └────────────────────┘

SimulateCustomPolicy()            #Req: SIMULATION
                                  #  - no PolicySourceArn, i.e. meant for resource-based policies
                                  #Res: EvaluationResult EVAL_RESULT_ARR
SimulatePrincipalPolicy()         #Req: SIMULATION
                                  #  - require PolicySourceArn, i.e. meant for identity-based policies
                                  #Res: EvaluationResult EVAL_RESULT_ARR

GetContextKeysForCustomPolicy()   #Retrieve all COND_KEYs used by specific POLICY_DOCs
                                  #Goal is to pass them as SIMULATION.ContextEntries
                                  #Req: PolicyInputList POLICY_DOC_ARR
                                  #Res: ContextKeyNames 'COND_KEY'_ARR
GetContextKeysForPrincipalPolicy()#Same but must also pass request parameters: PolicySourceArn GUROLE_ARN

                                  ┌──────────────────┐
                                  │   AUTH MESSAGE   │
                                  └──────────────────┘

ENCODED_AUTH_MESSAGE              #AWS 403 responses sometimes include an error message, which is encrypted.
                                  #Usually contains: ACTION, resource, PRINCIPAL, deny|allow, COND_KEYs
ENCODED_AUTH_MESSAGE
 .EncodedMessage                  #STR

DECODED_AUTH_MESSAGE              #Decrypted ENCODED_AUTH_MESSAGE
DECODED_AUTH_MESSAGE
 .DecodedMessage                  #STR

                                  ┌──────────────────────┐
                                  │   AUTH MESSAGE API   │
                                  └──────────────────────┘

DecodeAuthorizationMessage()      #Req: ENCODED_AUTH_MESSAGE
                                  #Res: DECODED_AUTH_MESSAGE

                                  ┌────────────────────────┐
                                  │   SERVER CERTIFICATE   │
                                  └────────────────────────┘

SERVER_CERTIFICATE                #X.509 server certificate
                                  #Must first create X.509 certificates manually
                                  #  - prefer using AWS Certificate Manager instead
                                  #Meant for HTTPS servers
                                  #Max 20 (flexible to 1000) (SUMMARY_MAP.ServerCertificates[Quota])
SERVER_CERTIFICATE.Arn            #SERVER_CERTIFICATE_ARN. 'arn:aws:iam::ACCOUNT_ID:server-certificate[/PATH]/NAME'
SERVER_CERTIFICATE
 .ServerCertificateId             #SERVER_CERTIFICATE_MID
SERVER_CERTIFICATE
 .ServerCertificateName           #'SERVER_CERTIFICATE'
SERVER_CERTIFICATE.Path           #NAMEPATH
SERVER_CERTIFICATE.UploadDate     #'DATE'
SERVER_CERTIFICATE.Expiration     #'DATE'
SERVER_CERTIFICATE.CertificateBody#'PEM'. X.509 public key certificate
SERVER_CERTIFICATE
 .CertificateChain                #'PEM'. Concatenation of public keys
SERVER_CERTIFICATE.PrivateKey     #'PEM'. Private key

SERVER_CERTIFICATE.Tags           #RESOURCE_NAME: ServerCertificateName 'SERVER_CERTIFICATE'

                                  ┌────────────────────────────┐
                                  │   SERVER CERTIFICATE API   │
                                  └────────────────────────────┘

UploadServerCertificate()         #Req: SERVER_CERTIFICATE
                                  #  - no Arn, ServerCertificateId, UploadDate, Expiration
                                  #Res: SERVER_CERTIFICATE
                                  #  - no CertificateBody, CertificateChain
                                  #  - Arn|ServerCertificateId|ServerCertificateName|Path|UploadDate|Expiration -> ServerCertificateMetadata.*
UpdateServerCertificate()         #Req:
                                  #  - no Arn, ServerCertificateId, UploadDate, Expiration, CertificateBody, CertificateChain, PrivateKey, Tags
                                  #  - ServerCertificateName -> ServerCertificateName + NewServerCertificateName
                                  #  - Path -> NewPath
                                  #Res: empty
GetServerCertificate()            #Req: SERVER_CERTIFICATE
                                  #  - only ServerCertificateName
                                  #Res: SERVER_CERTIFICATE
                                  #  - no PrivateKey
                                  #  - Arn|ServerCertificateId|ServerCertificateName|Path|UploadDate|Expiration -> ServerCertificateMetadata.*
ListServerCertificates()          #Req: SERVER_CERTIFICATE
                                  #  - only Path -> PathPrefix
                                  #Res: ServerCertificateMetadataList SERVER_CERTIFICATE_ARR
                                  #  - no CertificateBody, CertificateChain, PrivateKey, Tags
DeleteServerCertificate()         #Req: SERVER_CERTIFICATE
                                  #  - only ServerCertificateName
                                  #Res: empty

TagServerCertificate()
ListServerCertificateTags()
UntagServerCertificate()          #AWS TAGS

                                  ┌────────────────────────────┐
                                  │   SERVER CERTIFICATE IAC   │
                                  └────────────────────────────┘

AWS::IAM::ServerCertificate       #RESPROPs: ServerCertificateName, Path, CertificateBody, CertificateChain, PrivateKey, Tags
                                  #RESATTRs: Arn

                                  ┌───────────────────────────────┐
                                  │   SERVER CERTIFICATE PULUMI   │
                                  └───────────────────────────────┘

SERVER_CERTIFICATE.namePrefix     #Randomized suffix for SERVER_CERTIFICATE.ServerCertificateName

                                  ┌───────────────────┐
                                  │   ACCOUNT ALIAS   │
                                  └───────────────────┘

ACCOUNT_ALIAS                     #STR. Alias for ACCOUNT_ID
                                  #  - including in sign-in URL
                                  #Must be [[:alnum:]-] (hyphen only in middle)
                                  #Max 1 per ACCOUNT_ID

                                  ┌───────────────────────┐
                                  │   ACCOUNT ALIAS API   │
                                  └───────────────────────┘

CreateAccountAlias()              #Req: AccountAlias 'ACCOUNT_ALIAS'
                                  #Res: empty
ListAccountAliases()              #Req: empty
                                  #Res: AccountAliases 'ACCOUNT_ALIAS'_ARR
DeleteAccountAlias()              #Req: AccountAlias 'ACCOUNT_ALIAS'
                                  #Res: empty

                                  ┌──────────────────┐
                                  │   ORG ACCESSES   │
                                  └──────────────────┘

ORG_REQ.EntityPath                #'ORG_ID/ORG_ROOT_ID/PARENT_OU_ID/ACCOUNT_ID'
ORG_REQ.OrganizationsPolicyId     #ORG's POLICY (SCP) ID

ORG_JOB.JobId                     #STR
ORG_JOB.SortKey                   #'{TYPE}_ASCENDING|DESCENDING' with TYPE being 'SERVICE_NAMESPACE|LAST_AUTHENTICATED_TIME'

ORG_REPORT                        #List of all accesses in a given ORG
                                  #Meant to find unused permissions or POLICYs
                                  #  - for actual logging, use CloudTrail
                                  #Only last 400 days
                                  #Does not include:
                                  #  - anonymous accesses (e.g. S3)
                                  #  - iam:PassRole
                                  #Includes failed accesses
                                  #4-hours throttled
ORG_REPORT_ARN                    #'arn:aws:iam::ACCOUNT_ID:access-report/ENTITY_PATH'
ORG_REPORT.JobCreationDate        #'DATE'
ORG_REPORT.JobCompletionDate      #'DATE'. null if JobStatus 'IN_PROGRESS'
ORG_REPORT.JobStatus              #'IN_PROGRESS' or 'COMPLETED|FAILED'

ORG_REPORT
 .NumberOfServicesAccessible      #NUM of SERVICEs that can be accessed with the given ORG's POLICY (SCP)
ORG_REPORT
 .NumberOfServicesNotAccessed     #NUM of SERVICEs that can be accessed, but were not accessed

ORG_REPORT.ErrorDetails           #ORG_ERROR_ARR
ORG_ERROR.Code|Message            #STR. Error retrieving ORG_ACCESS

ORG_REPORT.AccessDetails          #ORG_ACCESS_ARR
ORG_ACCESS                        #Single access in a given ORG
ORG_ACCESS.Region                 #'REGION' being accessed
ORG_ACCESS.ServiceNamespace       #'SERVICE' being accessed
ORG_ACCESS.ServiceName            #'SERVICE' being accessed, human-friendly
ORG_ACCESS.LastAuthenticatedTime  #'DATE' of most recent access
ORG_ACCESS.EntityPath             #'ORG_ID/ORG_ROOT_ID/PARENT_OU_ID/ACCOUNT_ID' of the accessor
ORG_ACCESS
  .TotalAuthenticatedEntities     #NUM of ACCOUNTs within accessing ORG that tried to access

                                  ┌──────────────────────┐
                                  │   ORG ACCESSES API   │
                                  └──────────────────────┘

GenerateOrganizationsAccessReport #Req: ORG_REQ
 ()                               #Res: ORG_JOB
                                  #  - no SortKey
GetOrganizationsAccessReport()    #Req: ORG_JOB
                                  #Res: ORG_REPORT

                                  ┌───────────────────┐
                                  │   USER ACCESSES   │
                                  └───────────────────┘

SERVICE_REQ                       #Requests SERVICE_REPORT|SERVICE_ENTITIES_REPORT
SERVICE_REQ.Arn                   #USER|GROUP|ROLE|POLICY_ARN
SERVICE_REQ.Granularity           #Whether to include ACTION_ACCESSes: 'ACTION_LEVEL' (yes) or 'SERVICE_LEVEL' (no, def)

SERVICE_JOB.JobId                 #STR
SERVICE_JOB.ServiceNamespace      #'SERVICE'

SERVICE_REPORT                    #List of accesses for all SERVICEs
                                  #"IAM access advisor"
                                  #Same throttling and restrictions as ORG_REPORT

SERVICE_REPORT.JobCreationDate    #'DATE'
SERVICE_REPORT.JobCompletionDate  #'DATE'
SERVICE_REPORT.JobStatus          #'IN_PROGRESS' or 'COMPLETED|FAILED'
SERVICE_REPORT.Error.Code|Message #STR, when JobStatus 'FAILED'
SERVICE_REPORT.JobType            #SERVICE_REQ.Granularity

SERVICE_REPORT.ServiceLastAccessed#SERVICE_ACCESS_ARR
SERVICE_ACCESS                    #List of accesses for one SERVICE
SERVICE_ACCESS.ServiceNamespace   #'SERVICE' being accessed
SERVICE_ACCESS.ServiceName        #'SERVICE' being accessed, human-friendly
SERVICE_ACCESS.LastAuthenticated  #'DATE' of most recent access
SERVICE_ACCESS
 .LastAuthenticatedEntity         #USER|ROLE_ARN of accessor
SERVICE_ACCESS
 .LastAuthenticatedRegion         #'REGION' of the accessor
SERVICE_ACCESS
 .TotalAuthenticatedEntities      #NUM of USER|ROLEs that tried to access
SERVICE_ACCESS
 .TrackedActionsLastAccessed      #ACTION_ACCESS_ARR

ACTION_ACCESS                     #List of accesses for one ACTION
ACTION_ACCESS.ActionName          #'SERVICE_ACTION'
ACTION_ACCESS.LastAccessedTime    #'DATE' of most recent access
ACTION_ACCESS.LastAccessedEntity  #USER|ROLE_ARN of most recent accessor
ACTION_ACCESS.LastAccessedRegion  #'REGION' of most recent accessor

SERVICE_ENTITIES_REPORT           #List of accesses for one SERVICE
SERVICE_ENTITIES_REPORT
 .JobCompletionDate
 |JobCreationDate|JobStatus|Error #Like SERVICE_REPORT.*
SERVICE_ENTITIES_REPORT
 .EntityDetailsList               #ENTITY_ACCESS_ARR

ENTITY_ACCESS                     #List of accesses for one SERVICE and one UGROLE
ENTITY_ACCESS.LastAuthenticated   #'DATE' of most recent access
ENTITY_ACCESS.EntityInfo          #ENTITY_INFO
ENTITY_INFO.Arn                   #UGROLE_ARN
ENTITY_INFO.Id                    #UGROLE_MID
ENTITY_INFO.Name                  #'UGROLE'
ENTITY_INFO.Path                  #NAMEPATH
ENTITY_INFO.Type                  #'USER|GROUP|ROLE'

                                  ┌────────────────────────┐
                                  │   USER ACCESSES AUTH   │
                                  └────────────────────────┘

IAMAccessAdvisorReadOnly          #AWS managed POLICY. Permissions used by SERVICE_REQ

                                  ┌───────────────────────┐
                                  │   USER ACCESSES API   │
                                  └───────────────────────┘

GenerateServiceLastAccessedDetails#Req: SERVICE_REQ
 ()                               #Res: SERVICE_JOB
                                  #  - no ServiceNamespace

GetServiceLastAccessedDetails()   #Req: SERVICE_JOB
                                  #  - no ServiceNamespace
                                  #Res: SERVICE_REPORT

GetServiceLastAccessed            #Req: SERVICE_JOB
 DetailsWithEntities()            #Res: SERVICE_ENTITIES_REPORT

                                  ┌─────────────┐
                                  │   SUMMARY   │
                                  └─────────────┘

SUMMARY_REQ                       #
SUMMARY_REQ.Filter                #'User|Role|Group|LocalManagedPolicy|AWSManagedPolicy'_ARR
                                  #Exclude specific types from SUMMARY.*
SUMMARY                           #All of ACCOUNT's current UGROLEs, POLICYs, POLICY_VERSIONs, MPOLICYs, IPOLICYs, PERM_BOUNDARYs and INSTANCE_PROFILEs

SUMMARY.UserDetailList            #USER_INFO_ARR
USER_INFO                         #Like USER but without PasswordLastUsed

SUMMARY.GroupDetailList           #GROUP_INFO_ARR
GROUP_INFO                        #Like GROUP
USER_INFO.GroupList               #'GROUP_ARR'

SUMMARY.RoleDetailList            #ROLE_INFO_ARR
ROLE_INFO                         #Like ROLE but no Description, MaxSessionDuration

SUMMARY.Policies                  #POLICY_INFO_ARR
POLICY_INFO                       #Like POLICY but no Tags
POLICY_INFO.PolicyVersionList     #POLICY_VERSION_ARR, without PolicyArn

USER_INFO|GROUP_INFO|ROLE_INFO
 .AttachedManagedPolicies         #MPOLICY_INFO_ARR
MPOLICY_INFO                      #Like MPOLICY but without UGROLEName

USER_INFO.UserPolicyList
GROUP_INFO.GroupPolicyList
ROLE_INFO.RolePolicyList          #IPOLICY_INFO_ARR
IPOLICY_INFO                      #Like IPOLICY but without UGROLEName

USER_INFO|ROLE_INFO
 .PermissionsBoundary             #ATTACHED_PERM_BOUNDARY

ROLE_INFO.InstanceProfileList     #INSTANCE_PROFILE_ARR

                                  ┌─────────────────┐
                                  │   SUMMARY API   │
                                  └─────────────────┘

GetAccountAuthorizationDetails()  #Req: SUMMARY_REQ
                                  #Res: SUMMARY
